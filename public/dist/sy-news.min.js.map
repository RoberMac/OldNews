{"version":3,"sources":["core.js","syNews-i18n.js","syNews-stopPropagation.js","syNews-timeHelper.js"],"names":["angular","module","factory","store","getNamespacedStore","controller","$scope","$http","$timeout","$window","oneDayStore","syNewsTimeHelper","getSelectedDateNews","selectData","isPreload","isOldNews","checkSelectOldNewsCaret","checkSelectNewsCaret","cache_data","news_id","selectDate","selectCountry","newsBox","isShow","isNewsExist","isAllDay","newsBoxCache","get","post","success","data","status","headers","config","msg","storeOneDayNews","error","selectNewsInfo","isHideCaretLeft","getDayMs","Date","isHideCaretRight","now","selectOldNewsInfo","news","set","tomorrow","removeOneDayNews","ls","localStorage","len","length","reg","j","i","test","key","remove","isShowTimeMachine","toggleNews","element","document","documentElement","toggleClass","refreshNews","toggleTimeMachine","timeMachineInfo","H","getHours","M","getMonth","D","getDate","lastStep","getHoursMs","selectNews","step","timeMachineSelectNews","$watch","newVal","oldVal","directive","restrict","replace","template","showCountryList","country_list","cache","countryList","push","hideCountryList","country","index","indexOf","splice","unshift","changeLanguage","country_len","link","scope","elem","attr","bind","e","stopPropagation","service","this","hour","date","parse","getFullYear"],"mappings":"AAAAA,QAAQC,OAAO,cACX,UACA,YACA,kBACA,sCACA,2BACA,kCAEHC,QAAQ,eAAgB,QAAS,SAASC,GACvC,MAAOA,GAAMC,mBAAmB,eAAgB,QAEnDC,WAAW,kBACJ,SAAU,QAAS,WACnB,UAAW,QAAS,cACpB,mBACJ,SAAUC,EAAQC,EAAOC,EAAUC,EAASN,EAAOO,EAAaC,GAyIhE,QAASC,GAAoBC,EAAYC,GACrCR,EAAOS,UACLC,IACAC,GAEF,IACIC,GADAC,EAAUN,EAAWO,WAAad,EAAOe,aAY7C,OAVKP,KACDR,EAAOgB,WACPhB,EAAOiB,QAAU,EACjBjB,EAAOkB,aAAc,IAIzBN,EAAaL,EAAWY,SACtBC,EAAaP,GACbT,EAAYiB,IAAIR,SAETL,IACDR,EAAOgB,QAAUJ,EACjBZ,EAAOiB,QAAS,EAChBjB,EAAOkB,aAAc,QAK7BjB,GACCqB,KAAK,2BAA4Bf,GACjCgB,QAAQ,SAAUC,EAAMC,EAAQC,EAASC,GAClCA,EAAOH,KAAKL,SACZC,EAAaP,GAAWW,EAAKI,IAE7BC,EAAgBhB,EAASW,EAAKI,KAE9BpB,GACJN,EAAS,WACLF,EAAOgB,QAAUQ,EAAKI,IACtB5B,EAAOiB,QAAS,EAChBjB,EAAOkB,aAAc,GACtB,OAENY,MAAM,SAAUN,EAAMC,EAAQC,EAASC,GAChCnB,GACJN,EAAS,WACLF,EAAOgB,WACPhB,EAAOiB,QAAS,EAChBjB,EAAOkB,aAAc,GACtB,OAGX,QAASP,KACL,GAAIG,GAAad,EAAO+B,eAAejB,UAEvCd,GAAOgC,gBAAkBlB,EAAa,OAAYT,EAAiB4B,SAAS,GAAIC,QAC9E,GACA,EAEFlC,EAAOmC,iBAAmBrB,EAAa,KAAUoB,KAAKE,OACpD,GACA,EAEN,QAAS1B,KACL,GAAII,GAAad,EAAOqC,kBAAkBvB,UAC1Cd,GAAOgC,iBAAkB,EAEzBhC,EAAOmC,iBAAmBrB,EAAa,OAAYoB,KAAKE,OACtD,GACA,EAEN,QAASP,GAAgBhB,EAASyB,GAC9BlC,EAAYmC,IAAI1B,EAASyB,EACzB,IAAIE,GAAWN,KAAKE,MAAQ,KAC5BvC,GAAM0C,IAAI,oBAAqBlC,EAAiB4B,SAASO,IAE7D,QAASC,KAKL,IAAK,GAJDC,GAAKvC,EAAQwC,aACbC,EAAMD,aAAaE,OACnBC,EAAM,iBACNC,EAAI,EACCC,EAAI,EAAOJ,EAAJI,EAASA,IACrBF,EAAIG,KAAKP,EAAGQ,IAAIH,IACdlD,EAAMsD,OAAOT,EAAGQ,IAAIH,IACpBA,IAjNV/C,EAAOiB,QAAS,EAChBjB,EAAOkB,aAAc,EACrBlB,EAAOS,WAAY,EACnBT,EAAOoD,mBAAoB,EAC3BpD,EAAOqD,WAAa,WAChBrD,EAAOS,WAAaT,EAAOS,UAE3Bf,QACC4D,QAAQC,SAASC,iBACjBC,YAAY,WAEbzD,EAAO0D,eAEX1D,EAAO2D,kBAAoB,WAEvB3D,EAAO4D,iBACHC,EAAG,GAAI3B,MAAKlC,EAAO+B,eAAejB,YAAYgD,WAC9CC,EAAG,GAAI7B,MAAKlC,EAAOqC,kBAAkBvB,YAAYkD,WAAa,EAC9DC,EAAG,GAAI/B,MAAKlC,EAAOqC,kBAAkBvB,YAAYoD,WAErDlE,EAAOoD,mBAAqBpD,EAAOoD,kBAiBvC,IAAIhC,MACA+C,EAAW,EACfnE,GAAOgB,WACPhB,EAAOe,cAAgBlB,EAAMwB,IAAI,kBAAoB,KACrDrB,EAAO+B,gBACHjB,WAAYT,EAAiB+D,YAAW,GAAIlC,OAAO4B,YACnD/C,cAAef,EAAOe,cACtBI,UAAU,GAEdnB,EAAOqC,mBACHvB,WAAYT,EAAiB4B,SAASC,KAAKE,OAAS,MACpDrB,cAAef,EAAOe,cACtBI,UAAU,GAEdnB,EAAO4D,iBACHC,GAAG,GAAI3B,OAAO4B,WACdC,GAAG,GAAI7B,OAAO8B,WAAa,EAC3BC,GAAG,GAAI/B,OAAOgC,WAElBlE,EAAOgC,iBAAmB,EAC1BhC,EAAOmC,kBAAmB,EAC1BnC,EAAOqE,WAAa,SAAUC,GACrBtE,EAAOS,WAMRT,EAAOqC,kBAAkBvB,YAAc,MAAWwD,EAClDhE,EAAoBN,EAAOqC,qBAL3BrC,EAAO+B,eAAejB,YAAc,KAAUwD,EAC9ChE,EAAoBN,EAAO+B,iBAQ3BuC,IAASH,EACT7D,GACIQ,WAAYd,EAAOS,UACDT,EAAOqC,kBAAkBvB,WAAa,MAAWwD,EACjDtE,EAAO+B,eAAejB,WAAa,KAAUwD,EAC/DvD,cAAef,EAAOe,cACtBI,SAAUnB,EAAOS,WAAY,GAAO,IACrC,GAEH0D,EAAWG,GAGnBtE,EAAOuE,sBAAwB,WACtBvE,EAAOS,WAIRT,EAAOqC,kBAAkBvB,WAAaT,EAAiB4B,SACnD,GAAIC,MAAK,KACTlC,EAAO4D,gBAAgBG,EAAI,EAC3B/D,EAAO4D,gBAAgBK,IAE3B3D,EAAoBN,EAAOqC,qBAR3BrC,EAAO+B,eAAejB,WAAaT,EAAiB+D,WAAWpE,EAAO4D,gBAAgBC,GACtFvD,EAAoBN,EAAO+B,iBAS/B/B,EAAOoD,mBAAoB,GAE/BpD,EAAO0D,YAAc,WAEbpD,EADAN,EAAOS,UACaT,EAAOqC,kBAEPrC,EAAO+B,iBAKnC/B,EAAOwE,OAAO,gBAAiB,SAAUC,EAAQC,GAC7C1E,EAAO+B,eAAehB,cAAgB0D,EACtCzE,EAAOqC,kBAAkBtB,cAAgB0D,EAEzCA,IAAWC,EACT1E,EAAO0D,cACP,OAWN/C,IACAL,EAAoBN,EAAO+B,gBAC3BlC,EAAMwB,IAAI,qBAAuBa,KAAKE,MACpCK,IACA;ACvJN/C,QAAQC,OAAO,+BACdgF,UAAU,aAAc,WACrB,OACIC,SAAU,IACVC,SAAU,EACVC,SAAU,wNAKV/E,YAAa,SAAU,WAAY,QAAS,SAAUC,EAAQE,EAAUL,GAoBpE,QAASkF,KACL,IAAK,GAAI/B,GAAI,EAAGA,EAAIgC,EAAanC,OAAQG,IAAI,CAEzC,CAAA,GAAIiC,GAAQjF,EAAOkF,WACPD,GAAMpC,OAAS,EAE3BoC,EAAM,KAAOD,EAAahC,GACxBiC,EAAME,KAAKH,EAAahC,IACxB,KAEFhD,EAAOkF,YAAcD,GAG7B,QAASG,GAAgBC,GACrB,GAAIJ,GAAQjF,EAAOkF,YAEfI,GADQL,EAAMpC,OAAS,EACfoC,EAAMM,QAAQF,GAE1BJ,GAAMO,OAAOF,EAAO,GACpBL,EAAMQ,QAAQJ,GACdrF,EAAOkF,YAAcD,EAErB/E,EAAS,WACDmF,IAAYJ,EAAM,KAClBjF,EAAOkF,aAAeG,MA1ClC,GAAIL,IAAgB,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAEhFhF,GAAOkF,aAAelF,EAAOe,eAC7Bf,EAAO0F,eAAiB,SAAUL,GAC9B,CAAA,GAAIM,GAAc3F,EAAOkF,YAAYrC,MACzBmC,GAAaO,QAAQF,GAC7BA,IAAYrF,EAAOkF,YAAY,GAE/BF,EAAanC,SAAW8C,EACtBP,EAAgBC,GAChBN,KAGFlF,EAAM0C,IAAI,gBAAiB8C,GAC3BrF,EAAOe,cAAgBsE,EACvBD,EAAgBC;AC3BpC3F,QAAQC,OAAO,0CACdgF,UAAU,wBAAyB,WAChC,OACIC,SAAU,IACVgB,KAAM,SAAUC,EAAOC,EAAMC,GACzBD,EAAKE,KAAK,QAAS,SAAUC,GACzBA,EAAEC,oBAENJ,EAAKE,KAAK,aAAc,SAAUC,GAC9BA,EAAEC;ACTlBxG,QAAQC,OAAO,oCACdwG,QAAQ,mBAAoB,WAEzBC,KAAKhC,WAAa,SAASiC,GACvB,GAAIC,GAAO,GAAIpE,KACf,OAAQA,MAAKqE,MACD,GAAIrE,MACIoE,EAAKE,cACLF,EAAKtC,WACLsC,EAAKpC,UACLmC,KAIxBD,KAAKnE,SAAW,SAASqE,GACrB,GAAIA,GAAO,GAAIpE,MAAKoE,EACpB,OAAQpE,MAAKqE,MACD,GAAIrE,MACIoE,EAAKE,cACLF,EAAKtC,WACLsC,EAAKpC","file":"sy-news.min.js","sourcesContent":["angular.module('ShinyaNews', [\n    'ngTouch',\n    'ngAnimate',\n    'angular-storage',\n    'ShinyaNews.stopPropagationDirective',\n    'ShinyaNews.i18nDirective',\n    'ShinyaNews.timeHelperServices'\n])\n.factory('oneDayStore', ['store', function(store){\n    return store.getNamespacedStore('one-day-news', '-');\n}])\n.controller('rootController', [\n        '$scope', '$http', '$timeout', \n        '$window', 'store', 'oneDayStore', \n        'syNewsTimeHelper',\n    function ($scope, $http, $timeout, $window, store, oneDayStore, syNewsTimeHelper){\n\n    /*************\n     * 用戶介面相關\n     *\n     *  `$scope.isShow` 是否顯示 XXX（加載動畫、選擇新聞按鈕）\n     *  `$scope.isNewsExist` 是否顯示「獲取新聞錯誤」提醒\n     *  `$scope.isOldNews` & `$scope.toggleNews` 「新聞，」「舊聞。」切換\n     *  `$scope.isShowTimeMachine & $scope.toggleTimeMachine` 顯示／隱藏「跳躍性選擇新聞介面」\n     */\n    $scope.isShow = false\n    $scope.isNewsExist = true\n    $scope.isOldNews = false\n    $scope.isShowTimeMachine = false\n    $scope.toggleNews = function (){\n        $scope.isOldNews = !$scope.isOldNews\n        // 背景色\n        angular\n        .element(document.documentElement)\n        .toggleClass('oldNews')\n\n        $scope.refreshNews()\n    }\n    $scope.toggleTimeMachine = function (){\n        // 刷新時間\n        $scope.timeMachineInfo = {\n            H: new Date($scope.selectNewsInfo.selectDate).getHours(),\n            M: new Date($scope.selectOldNewsInfo.selectDate).getMonth() + 1,\n            D: new Date($scope.selectOldNewsInfo.selectDate).getDate()\n        }\n        $scope.isShowTimeMachine = !$scope.isShowTimeMachine\n    }\n\n\n    /*************\n     * 獲取新聞相關\n     *\n     *  `newsBoxCache` 緩存已獲取的新聞\n     *  `$scope.newsBox` 當前顯示的新聞\n     *  `$scope.selectNewsInfo` 存儲「新聞，」當前新聞日期信息\n     *  `$scope.selectOldNewsInfo` 存儲「舊聞。」當前新聞日期信息\n     *  `$scope.timeMachineInfo` 存儲「跳躍性選擇新聞」的日期信息\n     *  `$scope.isHideCaret--XXX` 是否隱藏選擇新聞按鈕\n     *  `$scope.selectNews` 選擇新聞\n     *  `$scope.timeMachineSelectNews` 「跳躍性選擇新聞」\n     *  `$scope.refreshNews` 刷新新聞\n     */\n    var newsBoxCache = {},\n        lastStep = -1;\n    $scope.newsBox = []\n    $scope.selectCountry = store.get('syNewsCountry') || 'HK'\n    $scope.selectNewsInfo = {\n        selectDate: syNewsTimeHelper.getHoursMs(new Date().getHours()),\n        selectCountry: $scope.selectCountry,\n        isAllDay: false\n    }\n    $scope.selectOldNewsInfo = {\n        selectDate: syNewsTimeHelper.getDayMs(Date.now()) - 86400000,\n        selectCountry: $scope.selectCountry,\n        isAllDay: true\n    }\n    $scope.timeMachineInfo = {\n        H: new Date().getHours(),\n        M: new Date().getMonth() + 1,\n        D: new Date().getDate()\n    }\n    $scope.isHideCaretLeft  = false\n    $scope.isHideCaretRight = false\n    $scope.selectNews = function (step){\n        if (!$scope.isOldNews){\n            // 選擇「新聞，」\n            $scope.selectNewsInfo.selectDate += 3600000 * step\n            getSelectedDateNews($scope.selectNewsInfo)\n        } else {\n            // 選擇「舊聞。」\n            $scope.selectOldNewsInfo.selectDate += 86400000 * step\n            getSelectedDateNews($scope.selectOldNewsInfo)\n        }\n\n        // 預加載判斷\n        if (step === lastStep){\n            getSelectedDateNews({\n                selectDate: $scope.isOldNews\n                                ? $scope.selectOldNewsInfo.selectDate + 86400000 * step\n                                : $scope.selectNewsInfo.selectDate + 3600000 * step,\n                selectCountry: $scope.selectCountry,\n                isAllDay: $scope.isOldNews ? true : false\n            }, true)\n        } else {\n            lastStep = step\n        }\n    }\n    $scope.timeMachineSelectNews = function (){\n        if (!$scope.isOldNews){\n            $scope.selectNewsInfo.selectDate = syNewsTimeHelper.getHoursMs($scope.timeMachineInfo.H)\n            getSelectedDateNews($scope.selectNewsInfo)\n        } else {\n            $scope.selectOldNewsInfo.selectDate = syNewsTimeHelper.getDayMs(\n                new Date(2015, \n                $scope.timeMachineInfo.M - 1, \n                $scope.timeMachineInfo.D)\n            )\n            getSelectedDateNews($scope.selectOldNewsInfo)\n        }\n        $scope.isShowTimeMachine = false\n    }\n    $scope.refreshNews = function(){\n        if ($scope.isOldNews){\n            getSelectedDateNews($scope.selectOldNewsInfo)\n        } else {\n            getSelectedDateNews($scope.selectNewsInfo)\n        }\n    }\n\n    // 當 `$scope.selectCountry` 變更，刷新「當前新聞信息」並獲取相應新聞\n    $scope.$watch('selectCountry', function (newVal, oldVal){\n        $scope.selectNewsInfo.selectCountry = newVal\n        $scope.selectOldNewsInfo.selectCountry = newVal\n\n        newVal !== oldVal\n        ? $scope.refreshNews()\n        : null\n    })\n\n    /*********\n     * Helper\n     *\n     *  `getSelectedDateNews` 獲取選擇時段／日期的新聞\n     *  `checkSelectNewsCaret` 檢測是否顯示選擇新聞按鈕\n     *  `storeOneDayNews` 存储新闻与本地並設置過期時間\n     *  `removeOneDayNews` 清除過期的新聞\n     */\n    checkSelectNewsCaret()\n    getSelectedDateNews($scope.selectNewsInfo)\n    store.get('oneDayNewsExpires') < Date.now()\n    ? removeOneDayNews()\n    : null\n    function getSelectedDateNews(selectData, isPreload){\n        $scope.isOldNews\n        ? checkSelectOldNewsCaret()\n        : checkSelectNewsCaret()\n\n        var news_id = selectData.selectDate + $scope.selectCountry,\n            cache_data;\n        if (!isPreload){\n            $scope.newsBox = []\n            $scope.isShow  = false\n            $scope.isNewsExist = true\n        }\n\n        // 尝试从本地获取新闻\n        cache_data = selectData.isAllDay\n        ? newsBoxCache[news_id]\n        : oneDayStore.get(news_id)\n        if (cache_data){\n            if (!isPreload){\n                $scope.newsBox = cache_data\n                $scope.isShow = true\n                $scope.isNewsExist = true\n            }\n            return;\n        }\n        // 否则，從服務器获取新闻\n        $http\n        .post('/api/getSelectedDateNews', selectData)\n        .success(function (data, status, headers, config){\n            if (config.data.isAllDay){\n                newsBoxCache[news_id] = data.msg\n            } else {\n                storeOneDayNews(news_id, data.msg)\n            }\n            if (isPreload){ return; }\n            $timeout(function (){\n                $scope.newsBox = data.msg\n                $scope.isShow = true\n                $scope.isNewsExist = true\n            }, 717)\n        })\n        .error(function (data, status, headers, config){\n            if (isPreload){ return; }\n            $timeout(function (){\n                $scope.newsBox = []\n                $scope.isShow = true\n                $scope.isNewsExist = false\n            }, 717)\n        })\n    }\n    function checkSelectNewsCaret(){\n        var selectDate = $scope.selectNewsInfo.selectDate\n        // 小於今日 0 時\n        $scope.isHideCaretLeft = selectDate - 3600000 === syNewsTimeHelper.getDayMs(new Date())\n        ? true\n        : false\n        // 大於現在時間\n        $scope.isHideCaretRight = selectDate + 3600000 > Date.now()\n        ? true\n        : false\n    }\n    function checkSelectOldNewsCaret(){\n        var selectDate = $scope.selectOldNewsInfo.selectDate\n        $scope.isHideCaretLeft = false\n        // 大於今日\n        $scope.isHideCaretRight = selectDate + 172800000 > Date.now()\n        ? true\n        : false\n    }\n    function storeOneDayNews(news_id, news){\n        oneDayStore.set(news_id, news)\n        var tomorrow = Date.now() + 86400000\n        store.set('oneDayNewsExpires', syNewsTimeHelper.getDayMs(tomorrow))\n    }\n    function removeOneDayNews(){\n        var ls = $window.localStorage,\n            len = localStorage.length,\n            reg = /^one-day-news-/,\n            j = 0;\n        for (var i = 0; i < len; i++){\n            reg.test(ls.key(j))\n            ? store.remove(ls.key(j))\n            : j ++\n        }\n    }\n}])","angular.module('ShinyaNews.i18nDirective', [])\n.directive('syNewsI18n', function (){\n    return {\n        restrict: 'E',\n        replace : true,\n        template: '<div class=\"corner--top--left animate--faster\">'\n                +   '<div ng-repeat=\"country in countryList\" class=\"toolBar__button--country animate--faster\" ng-class=\"country\" ng-click=\"changeLanguage(country)\">'\n                +       '{{country}}'\n                +   '</div>'\n                + '</div>',\n        controller: ['$scope', '$timeout', 'store', function ($scope, $timeout, store){\n\n            var country_list = ['HK', 'CN', 'JP', 'TW', 'US', 'BR', 'IN', 'KR', 'RU', 'DE', 'FR']\n\n            $scope.countryList = [$scope.selectCountry]\n            $scope.changeLanguage = function (country){\n                var country_len = $scope.countryList.length,\n                    index = country_list.indexOf(country);\n                if (country === $scope.countryList[0]){\n                    // 顯示／隱藏「國家列表」\n                    country_list.length === country_len\n                    ? hideCountryList(country)\n                    : showCountryList()\n                } else {\n                    // 更改國家\n                    store.set('syNewsCountry', country)\n                    $scope.selectCountry = country\n                    hideCountryList(country)\n                }\n            }\n            function showCountryList(){\n                for (var i = 0; i < country_list.length; i++){\n\n                    var cache = $scope.countryList,\n                        len   = cache.length - 1;\n\n                    cache[0] !== country_list[i]\n                    ? cache.push(country_list[i])\n                    : null\n\n                    $scope.countryList = cache\n                }\n            }\n            function hideCountryList(country){\n                var cache = $scope.countryList,\n                    len   = cache.length - 1,\n                    index = cache.indexOf(country);\n\n                cache.splice(index, 1)\n                cache.unshift(country)\n                $scope.countryList = cache\n\n                $timeout(function (){\n                    if (country === cache[0]){\n                        $scope.countryList = [country]\n                    }\n                })\n            }\n        }]\n    }\n})","angular.module('ShinyaNews.stopPropagationDirective', [])\n.directive('syNewsStopPropagation', function (){\n    return {\n        restrict: 'A',\n        link: function (scope, elem, attr){\n            elem.bind('click', function (e){\n                e.stopPropagation()\n            })\n            elem.bind('touchstart', function (e){\n                e.stopPropagation()\n            })\n        }\n    }\n})","angular.module('ShinyaNews.timeHelperServices', [])\n.service('syNewsTimeHelper', function(){\n\n    this.getHoursMs = function(hour){\n        var date = new Date()\n        return  Date.parse(\n                    new Date(\n                            date.getFullYear(),\n                            date.getMonth(),\n                            date.getDate(),\n                            hour\n                        )\n                )\n    },\n    this.getDayMs = function(date){\n        var date = new Date(date)\n        return  Date.parse(\n                    new Date(\n                            date.getFullYear(),\n                            date.getMonth(),\n                            date.getDate()\n                        )\n                )\n    }\n})"],"sourceRoot":"/source/"}