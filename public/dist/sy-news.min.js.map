{"version":3,"sources":["core.js","syNews-timeHelper.js"],"names":["angular","module","factory","store","getNamespacedStore","controller","$scope","$http","$timeout","$window","oneDayStore","syNewsTimeHelper","getSelectedDateNews","selectData","cache_data","news_id","selectDate","selectCountry","newsBox","isShow","isNewsExist","isAllDay","newsBoxCache","get","post","success","data","status","headers","config","msg","storeOneDayNews","error","checkSelectNewsCaret","selectNewsInfo","isHideCaretLeft","getLocalDayMs","Date","isHideCaretRight","now","checkSelectOldNewsCaret","selectOldNewsInfo","news","set","tomorrow","removeOneDayNews","ls","localStorage","len","length","reg","j","i","test","key","remove","isOldNews","toggleNews","element","document","documentElement","toggleClass","getUTCDayMs","getUTCHours","selectNews","step","service","this","date","UTC","getUTCFullYear","getUTCMonth","getUTCDate","parse","getFullYear","getMonth","getDate"],"mappings":"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","file":"sy-news.min.js","sourcesContent":["angular.module('ShinyaNews', [\n    'ngTouch',\n    'ngAnimate',\n    'angular-storage',\n    'ShinyaNews.timeHelperServices'\n])\n.factory('oneDayStore', ['store', function(store){\n    return store.getNamespacedStore('one-day-news', '-');\n}])\n.controller('rootController', ['$scope', '$http', '$timeout', '$window', 'store', 'oneDayStore', 'syNewsTimeHelper',\n    function ($scope, $http, $timeout, $window, store, oneDayStore, syNewsTimeHelper){\n\n    /*************\n     * 用戶介面相關\n     *\n     *  `$scope.isShow` 是否顯示 XXX（加載動畫、選擇新聞按鈕）\n     *  `$scope.isNewsExist` 是否顯示「獲取新聞錯誤」提醒\n     *  `$scope.isOldNews` & `$scope.toggleNews` 「新聞，」「舊聞。」切換\n     *  ``\n     */\n    $scope.isShow = false\n    $scope.isNewsExist = true\n    $scope.isOldNews = false\n    $scope.toggleNews = function (){\n        $scope.isOldNews = !$scope.isOldNews\n        // 背景色\n        angular\n        .element(document.documentElement)\n        .toggleClass('oldNews')\n        // 獲取新聞\n        if ($scope.isOldNews){\n            checkSelectOldNewsCaret()\n            getSelectedDateNews($scope.selectOldNewsInfo)\n        } else {\n            checkSelectNewsCaret()\n            getSelectedDateNews($scope.selectNewsInfo)\n        }\n    }\n\n\n    /*************\n     * 獲取新聞相關\n     *\n     *  `newsBoxCache` 緩存已獲取的新聞\n     *  `$scope.newsBox` 當前顯示的新聞\n     *  `$scope.selectNewsInfo` 存儲「新聞，」當前新聞日期信息\n     *  `$scope.selectOldNewsInfo` 存儲「舊聞。」當前新聞日期信息\n     *  `$scope.isHideCaret--XXX` 是否隱藏選擇新聞按鈕\n     *  `$scope.selectNews` 選擇新聞\n     */\n    var newsBoxCache = {}\n    $scope.newsBox = []\n    $scope.selectCountry = 'CN'\n    $scope.selectNewsInfo = {\n        selectDate: syNewsTimeHelper.getUTCDayMs(new Date()) + new Date().getUTCHours() * 3600000,\n        selectCountry: $scope.selectCountry,\n        isAllDay: false\n    }\n    $scope.selectOldNewsInfo = {\n        selectDate: syNewsTimeHelper.getLocalDayMs(Date.now()) - 86400000,\n        selectCountry: $scope.selectCountry,\n        isAllDay: true\n    }\n    $scope.isHideCaretLeft  = false\n    $scope.isHideCaretRight = false\n    $scope.selectNews = function (step){\n        if (!$scope.isOldNews){\n            // 選擇「新聞，」\n            $scope.selectNewsInfo.selectDate += 3600000 * step\n            getSelectedDateNews($scope.selectNewsInfo)\n            checkSelectNewsCaret()\n        } else {\n            // 選擇「舊聞。」\n            $scope.selectOldNewsInfo.selectDate += 86400000 * step\n            getSelectedDateNews($scope.selectOldNewsInfo)\n            checkSelectOldNewsCaret()\n        }\n    }\n\n\n    /*********\n     * Helper\n     *\n     *  `getSelectedDateNews` 獲取選擇時段／日期的新聞\n     *  `checkSelectNewsCaret` 檢測是否顯示選擇新聞按鈕\n     *  `storeOneDayNews` 存储新闻与本地並設置過期時間\n     *  `removeOneDayNews` 清除過期的新聞\n     */\n    checkSelectNewsCaret()\n    getSelectedDateNews($scope.selectNewsInfo)\n    store.get('oneDayNewsExpires') < Date.now()\n    ? removeOneDayNews()\n    : null\n    function getSelectedDateNews(selectData){\n        var news_id = selectData.selectDate + $scope.selectCountry,\n            cache_data;\n        $scope.newsBox = []\n        $scope.isShow  = false\n        $scope.isNewsExist = true\n\n        // 尝试从本地获取新闻\n        cache_data = selectData.isAllDay\n        ? newsBoxCache[news_id]\n        : oneDayStore.get(news_id)\n        if (cache_data){\n            $scope.newsBox = cache_data\n            $scope.isShow = true\n            $scope.isNewsExist = true\n            return;\n        }\n        // 否则，從服務器获取新闻\n        $http\n        .post('/api/getSelectedDateNews', selectData)\n        .success(function (data, status, headers, config){\n            if (config.data.isAllDay){\n                newsBoxCache[news_id] = data.msg\n            } else {\n                storeOneDayNews(news_id, data.msg)\n            }\n            $timeout(function (){\n                $scope.newsBox = data.msg\n                $scope.isShow = true\n                $scope.isNewsExist = true\n            }, 717)\n        })\n        .error(function (data, status, headers, config){\n            $timeout(function (){\n                $scope.newsBox = []\n                $scope.isShow = true\n                $scope.isNewsExist = false\n            }, 717)\n            // cb('error', data.msg || $translate.instant('chat.NETWORK_ERROR_MSG'))\n        })\n    }\n    function checkSelectNewsCaret(){\n        var selectDate = $scope.selectNewsInfo.selectDate\n        // 小於今日 0 時\n        $scope.isHideCaretLeft = selectDate - 3600000 === syNewsTimeHelper.getLocalDayMs(new Date())\n        ? true\n        : false\n        // 大於現在時間\n        $scope.isHideCaretRight = selectDate + 3600000 > Date.now()\n        ? true\n        : false\n    }\n    function checkSelectOldNewsCaret(){\n        var selectDate = $scope.selectOldNewsInfo.selectDate\n        // 大於今日\n        $scope.isHideCaretRight = selectDate + 172800000 > Date.now()\n        ? true\n        : false\n    }\n    function storeOneDayNews(news_id, news){\n        oneDayStore.set(news_id, news)\n        var tomorrow = Date.now() + 86400000\n        store.set('oneDayNewsExpires', syNewsTimeHelper.getLocalDayMs(tomorrow))\n    }\n    function removeOneDayNews(){\n        var ls = $window.localStorage,\n            len = localStorage.length,\n            reg = /^one-day-news-/,\n            j = 0;\n        for (var i = 0; i < len; i++){\n            reg.test(ls.key(j))\n            ? store.remove(ls.key(j))\n            : j ++\n        }\n    }\n}])","angular.module('ShinyaNews.timeHelperServices', [])\n.service('syNewsTimeHelper', function(){\n\n    this.getUTCDayMs = function(date){\n        var date = new Date(date)\n        return  Date.UTC(\n                    date.getUTCFullYear(),\n                    date.getUTCMonth(),\n                    date.getUTCDate()\n                )\n    },\n    this.getLocalDayMs = function(date){\n        var date = new Date(date)\n        return  Date.parse(\n                    new Date(\n                            date.getFullYear(),\n                            date.getMonth(),\n                            date.getDate()\n                        )\n                )\n    }\n})"],"sourceRoot":"/source/"}