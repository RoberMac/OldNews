{"version":3,"sources":["core.js","syNews-i18n.js","syNews-stopPropagation.js","syNews-timeHelper.js"],"names":["angular","module","config","$locationProvider","$stateProvider","$urlRouterProvider","otherwise","now","Date","year","getFullYear","month","getMonth","day","getDate","h","getHours","country","localStorage","getItem","JSON","parse","html5Mode","state","abstract","url","template","controller","$scope","$stateParams","saveCountry","parent","templateUrl","store","syNewsTimeHelper","hour","isToday","selectNewsInfo","selectDate","toHourMs","selectOldNewsInfo","toDayMs","set","isOldNews","toggleNews","refreshNews","factory","getNamespacedStore","$http","$timeout","$window","$state","oneDayStore","setSelectNewsState","data","isShow","isNewsExist","newsBox","getSelectedDateNews","selectData","isPreload","checkSelectOldNewsCaret","checkSelectNewsCaret","cache_data","newsID","selectCountry","lastStep","isHideCaretRight","isHideCaretLeft","isAllDay","newsBoxCache","get","post","success","status","headers","msg","storeOneDayNews","error","getDayMs","news","tomorrow","removeOneDayNews","ls","len","length","reg","j","i","test","key","remove","isShowTimeMachine","elem","element","document","getElementById","addClass","removeClass","newsDate","getHoursMs","go","toString","oldNewsDate","documentElement","toggleClass","toggleTimeMachine","timeMachineInfo","H","M","D","selectNews","step","console","log","parseInt","timeMachineSelectNews","directive","restrict","replace","showCountryList","country_list","cache","countryList","push","hideCountryList","index","indexOf","splice","unshift","changeCountry","country_len","link","scope","attr","bind","e","stopPropagation","service","this","date","now_year","now_month","now_day"],"mappings":"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","file":"sy-news.min.js","sourcesContent":["angular.module('ShinyaNews', [\n    'ngTouch',\n    'ngAnimate',\n    'ui.router',\n    'angular-storage',\n    'ShinyaNews.stopPropagationDirective',\n    'ShinyaNews.i18nDirective',\n    'ShinyaNews.timeHelperServices'\n])\n.config(['$locationProvider', '$stateProvider', '$urlRouterProvider', \n    function($locationProvider, $stateProvider, $urlRouterProvider) {\n\n    // 無效 URL，跳轉到今日現時「新聞，」\n    $urlRouterProvider.otherwise(function (){\n        var now     = new Date(),\n            year    = now.getFullYear(),\n            month   = now.getMonth() + 1,\n            day     = now.getDate(),\n            h       = now.getHours(),\n            country = localStorage.getItem('syNewsCountry') || '\"HK\"';\n\n        return JSON.parse(country) + '/' + year + '/' + month + '/' + day + '?h=' + h;\n    })\n\n    $locationProvider.html5Mode(true)\n\n    $stateProvider\n        .state('country', {\n            abstract: true,\n            url: \"/{country:BR|CN|DE|FR|HK|IN|JP|KR|RU|TW|US}\",\n            template: '<div ui-view></div>',\n            controller: ['$scope', '$stateParams', function ($scope, $stateParams){\n                // 更改並保存「國家」\n                $scope.saveCountry($stateParams.country)\n            }]\n        })\n        .state('date', {\n            parent: 'country',\n            url: \"/{year:2015}/{month:0?[1-9]|1[0-2]}/{day:0?[0-9]|[12][0-9]|3[0-1]}?h\",\n            templateUrl: '/public/dist/newsBox.min.html',\n            controller: ['$scope', '$stateParams', 'store', 'syNewsTimeHelper', \n                function ($scope, $stateParams, store, syNewsTimeHelper){\n\n                var year    = $stateParams.year,\n                    month   = $stateParams.month,\n                    day     = $stateParams.day,\n                    hour    = $stateParams.h > 0 && $stateParams.h <= 24\n                                ? $stateParams.h\n                                : new Date().getHours();\n\n                if (syNewsTimeHelper.isToday(year, month, day)){\n                    $scope.selectNewsInfo.selectDate = syNewsTimeHelper.toHourMs(year, month, day, hour)\n                } else {\n                    $scope.selectOldNewsInfo.selectDate = syNewsTimeHelper.toDayMs(year, month, day)\n                    store.set('lastOldNewsDate', $scope.selectOldNewsInfo.selectDate)\n\n                    $scope.isOldNews\n                    ? null\n                    : $scope.toggleNews() // 從 URL 直接訪問「舊聞。」\n                }\n                $scope.refreshNews()\n            }]\n        })\n\n}])\n.factory('oneDayStore', ['store', function(store){\n    return store.getNamespacedStore('one-day-news', '-');\n}])\n.controller('rootController', [\n        '$scope', '$http', '$timeout', \n        '$window', '$state', '$stateParams', 'store', \n        'oneDayStore', 'syNewsTimeHelper',\n    function ($scope, $http, $timeout, $window, $state, $stateParams, store, oneDayStore, syNewsTimeHelper){\n\n    // 刪除緩存於本地的過期信息\n    store.get('oneDayNewsExpires') < Date.now()\n    ? removeOneDayNews()\n    : null\n\n    /*************\n     * 用戶介面相關\n     *\n     *  `$scope.isShow` 是否顯示 XXX（加載動畫、選擇新聞按鈕）\n     *  `$scope.isNewsExist` 是否顯示「獲取新聞錯誤」提醒\n     *  `$scope.isOldNews` & `$scope.toggleNews` 「新聞，」「舊聞。」切換\n     *  `$scope.isShowTimeMachine & $scope.toggleTimeMachine` 顯示／隱藏「跳躍性選擇新聞介面」\n     */\n    $scope.isShow = false\n    $scope.isNewsExist = true\n    $scope.isOldNews = false\n    $scope.isShowTimeMachine = false\n    $scope.toggleNews = function (){\n\n        // 翻面動畫\n        var elem = angular.element(document.getElementById('view-newsBox'))\n        elem.addClass('cardFlip')\n        $timeout(function (){\n            elem.removeClass('cardFlip')\n        }, 777)\n\n        if ($scope.isOldNews){\n            // 切換到「新聞，」\n            var newsDate = new Date($scope.selectNewsInfo.selectDate \n                            || syNewsTimeHelper.getHoursMs(new Date().getHours()))\n            $state.go('date', {\n                year : newsDate.getFullYear().toString(),\n                month: (newsDate.getMonth() + 1).toString(),\n                day  : newsDate.getDate().toString(),\n                h    : newsDate.getHours().toString()\n            })\n        } else {\n            // 切換到「舊聞。」\n            var oldNewsDate = new Date($scope.selectOldNewsInfo.selectDate\n                                || syNewsTimeHelper.getDayMs(Date.now()) - 86400000)\n            $state.go('date', {\n                year : oldNewsDate.getFullYear().toString(),\n                month: (oldNewsDate.getMonth() + 1).toString(),\n                day  : oldNewsDate.getDate().toString(),\n                h    : null\n            })\n        }\n\n        $scope.isOldNews = !$scope.isOldNews\n        // 背景色\n        angular\n        .element(document.documentElement)\n        .toggleClass('oldNews')\n    }\n    $scope.toggleTimeMachine = function (){\n        // 刷新時間\n        $scope.timeMachineInfo = {\n            H: new Date($scope.selectNewsInfo.selectDate).getHours(),\n            M: new Date($scope.selectOldNewsInfo.selectDate).getMonth() + 1,\n            D: new Date($scope.selectOldNewsInfo.selectDate).getDate()\n        }\n        $scope.isShowTimeMachine = !$scope.isShowTimeMachine\n    }\n\n\n    /*************\n     * 獲取新聞相關\n     *\n     *  `newsBoxCache` 緩存已獲取的新聞\n     *  `$scope.newsBox` 當前顯示的新聞\n     *  `$scope.selectNewsInfo` 存儲「新聞，」當前新聞日期信息\n     *  `$scope.selectOldNewsInfo` 存儲「舊聞。」當前新聞日期信息\n     *  `$scope.timeMachineInfo` 存儲「跳躍性選擇新聞」的日期信息\n     *  `$scope.isHideCaret--XXX` 是否隱藏選擇新聞按鈕\n     *  `$scope.selectNews` 選擇新聞\n     *  `$scope.timeMachineSelectNews` 「跳躍性選擇新聞」\n     *  `$scope.refreshNews` 刷新新聞\n     */\n    var newsBoxCache = {},\n        lastStep = -1;\n    $scope.newsBox = []\n    $scope.selectCountry = store.get('syNewsCountry') || 'HK'\n    $scope.selectNewsInfo = {\n        selectDate: 0,\n        selectCountry: $scope.selectCountry,\n        isAllDay: false\n    }\n    $scope.selectOldNewsInfo = {\n        selectDate: store.get('lastOldNewsDate'),\n        selectCountry: $scope.selectCountry,\n        isAllDay: true\n    }\n    $scope.timeMachineInfo = {}\n    $scope.isHideCaretLeft  = false\n    $scope.isHideCaretRight = false\n    $scope.selectNews = function (step){\n\n        var elem = angular.element(document.getElementById('view-newsBox'))\n        if (step === 1){\n            elem.removeClass('rtl')\n        } else {\n            elem.addClass('rtl')\n        }\n        console.log(angular.element(document.getElementById('view-newsBox')))\n\n        // 屏蔽（移動端）無效的獲取新聞（滑動）\n        if (step === 1 && $scope.isHideCaretRight || step === -1 && $scope.isHideCaretLeft){ return; }\n\n        if (!$scope.isOldNews){\n            // 選擇「新聞，」\n            $state.go('date', {\n                year : $stateParams.year,\n                month: $stateParams.month,\n                day  : $stateParams.day,\n                h    : (parseInt($stateParams.h \n                                    ? $stateParams.h \n                                    : new Date().getHours()\n                                ) + step).toString()\n            })\n        } else {\n            // 選擇「舊聞。」\n            $state.go('date', {\n                year : $stateParams.year,\n                month: $stateParams.month,\n                day  : (parseInt($stateParams.day) + step).toString(),\n                h    : null\n            })\n        }\n\n        // 預加載判斷\n        if (step === lastStep){\n            getSelectedDateNews({\n                selectDate: $scope.isOldNews\n                                ? $scope.selectOldNewsInfo.selectDate + 172800000 * step\n                                : $scope.selectNewsInfo.selectDate + 7200000 * step,\n                selectCountry: $scope.selectCountry,\n                isAllDay: $scope.isOldNews ? true : false\n            }, true)\n        } else {\n            lastStep = step\n        }\n    }\n    $scope.timeMachineSelectNews = function (){\n        if (!$scope.isOldNews){\n            $state.go('date', {\n                year : $stateParams.year,\n                month: $stateParams.month,\n                day  : $stateParams.day,\n                h    : $scope.timeMachineInfo.H\n            })\n        } else {\n            $state.go('date', {\n                year : $stateParams.year,\n                month: $scope.timeMachineInfo.M,\n                day  : $scope.timeMachineInfo.D,\n                h    : null\n            })\n        }\n        $scope.isShowTimeMachine = false\n    }\n    $scope.refreshNews = function(){\n        $scope.isOldNews\n        ? getSelectedDateNews($scope.selectOldNewsInfo)\n        : getSelectedDateNews($scope.selectNewsInfo)\n    }\n\n\n    /*********\n     * Helper\n     *\n     *  `setSelectNewsState` 設置 `$scope.newsBox`, `$scope.isShow` & `$scope.isNewsExist`\n     *  `getSelectedDateNews` 獲取選擇時段／日期的新聞\n     *  `checkSelectNewsCaret` 檢測是否顯示選擇新聞按鈕\n     *  `storeOneDayNews` 存储新闻与本地並設置過期時間\n     *  `removeOneDayNews` 清除過期的新聞\n     */\n    function setSelectNewsState(data, isShow, isNewsExist){\n        $scope.newsBox     = data\n        $scope.isShow      = isShow\n        $scope.isNewsExist = isNewsExist\n    }\n    function getSelectedDateNews(selectData, isPreload){\n        $scope.isOldNews\n        ? checkSelectOldNewsCaret()\n        : checkSelectNewsCaret()\n\n        var newsID = selectData.selectDate + $scope.selectCountry,\n            cache_data;\n\n        if (isPreload){\n            // 取消預加載此新聞\n            if (lastStep === 1 && $scope.isHideCaretRight || lastStep === -1 && $scope.isHideCaretLeft ){\n                return;\n            }\n        } else {\n            setSelectNewsState([], false, true)\n        }\n\n        // 尝试从本地获取新闻\n        cache_data = selectData.isAllDay\n        ? newsBoxCache[newsID]\n        : oneDayStore.get(newsID)\n        if (cache_data){\n            isPreload\n            ? null\n            : setSelectNewsState(cache_data, true, true)\n\n            return;\n        }\n        // 否则，從服務器获取新闻\n        $http\n        .post('/api/getSelectedDateNews', selectData)\n        .success(function (data, status, headers, config){\n            if (config.data.isAllDay){\n                newsBoxCache[newsID] = data.msg\n            } else {\n                storeOneDayNews(newsID, data.msg)\n            }\n            if (isPreload){ return; }\n            setSelectNewsState(data.msg, true, true)\n        })\n        .error(function (data, status, headers, config){\n            if (isPreload){ return; }\n            setSelectNewsState([], true, false)\n        })\n    }\n    function checkSelectNewsCaret(){\n        var selectDate = $scope.selectNewsInfo.selectDate\n        // 小於今日 0 時\n        $scope.isHideCaretLeft = selectDate - 3600000 === syNewsTimeHelper.getDayMs(new Date())\n        ? true\n        : false\n        // 大於現在時間\n        $scope.isHideCaretRight = selectDate + 3600000 > Date.now()\n        ? true\n        : false\n    }\n    function checkSelectOldNewsCaret(){\n        var selectDate = $scope.selectOldNewsInfo.selectDate\n        $scope.isHideCaretLeft = false\n        // 大於今日\n        $scope.isHideCaretRight = selectDate + 172800000 > Date.now()\n        ? true\n        : false\n    }\n    function storeOneDayNews(newsID, news){\n        oneDayStore.set(newsID, news)\n        var tomorrow = Date.now() + 86400000\n        store.set('oneDayNewsExpires', syNewsTimeHelper.getDayMs(tomorrow))\n    }\n    function removeOneDayNews(){\n        var ls = $window.localStorage,\n            len = localStorage.length,\n            reg = /^one-day-news-/,\n            j = 0;\n        for (var i = 0; i < len; i++){\n            reg.test(ls.key(j))\n            ? store.remove(ls.key(j))\n            : j ++\n        }\n    }\n}])","angular.module('ShinyaNews.i18nDirective', [])\n.directive('syNewsI18n', function (){\n    return {\n        restrict: 'E',\n        replace : true,\n        template: '<div class=\"corner--top--left animate--faster\">'\n                +   '<div ng-repeat=\"country in countryList\" class=\"toolBar__button--country animate--faster\" ng-class=\"country\" ng-click=\"changeCountry(country)\">'\n                +       '{{country}}'\n                +   '</div>'\n                + '</div>',\n        controller: ['$scope', '$timeout', '$state', '$stateParams' , 'store', \n            function ($scope, $timeout, $state, $stateParams, store){\n\n            var country_list = ['HK', 'CN', 'JP', 'TW', 'US', 'BR', 'IN', 'KR', 'RU', 'DE', 'FR']\n\n            $scope.countryList = [$scope.selectCountry]\n            $scope.changeCountry = function (country){\n                var country_len = $scope.countryList.length,\n                    index = country_list.indexOf(country);\n                if (country === $scope.countryList[0]){\n                    // 顯示／隱藏「國家列表」\n                    country_list.length === country_len\n                    ? hideCountryList(country)\n                    : showCountryList()\n                } else {\n                    // 更改國家\n                    $state.go('date', {\n                        country: country,\n                        year   : $stateParams.year,\n                        month  : $stateParams.month,\n                        day    : $stateParams.day,\n                        h      : $stateParams.h\n                    })\n                }\n            }\n            $scope.saveCountry = function (country){\n                store.set('syNewsCountry', country)\n                $scope.selectCountry = country\n                $scope.selectNewsInfo.selectCountry = country\n                $scope.selectOldNewsInfo.selectCountry = country\n                hideCountryList(country)\n            }\n            function showCountryList(){\n                for (var i = 0; i < country_list.length; i++){\n\n                    var cache = $scope.countryList,\n                        len   = cache.length - 1;\n\n                    cache[0] !== country_list[i]\n                    ? cache.push(country_list[i])\n                    : null\n\n                    $scope.countryList = cache\n                }\n            }\n            function hideCountryList(country){\n                var cache = $scope.countryList,\n                    len   = cache.length - 1,\n                    index = cache.indexOf(country);\n\n                cache.splice(index, 1)\n                cache.unshift(country)\n                $scope.countryList = cache\n\n                $timeout(function (){\n                    if (country === cache[0]){\n                        $scope.countryList = [country]\n                    }\n                })\n            }\n        }]\n    }\n})","angular.module('ShinyaNews.stopPropagationDirective', [])\n.directive('syNewsStopPropagation', function (){\n    return {\n        restrict: 'A',\n        link: function (scope, elem, attr){\n            elem.bind('click', function (e){\n                e.stopPropagation()\n            })\n            elem.bind('touchstart', function (e){\n                e.stopPropagation()\n            })\n        }\n    }\n})","angular.module('ShinyaNews.timeHelperServices', [])\n.service('syNewsTimeHelper', function(){\n\n    this.getHoursMs = function(hour){\n        var date = new Date()\n        return  Date.parse(\n                    new Date(\n                            date.getFullYear(),\n                            date.getMonth(),\n                            date.getDate(),\n                            hour\n                        )\n                )\n    },\n    this.getDayMs = function(date){\n        var date = new Date(date)\n        return  Date.parse(\n                    new Date(\n                            date.getFullYear(),\n                            date.getMonth(),\n                            date.getDate()\n                        )\n                )\n    },\n    this.isToday = function (year, month, day){\n        var now       = new Date(),\n            now_year  = now.getFullYear(),\n            now_month = now.getMonth() + 1,\n            now_day   = now.getDate();\n\n        return year == now_year && month == now_month && day == now_day\n    },\n    this.toDayMs = function (year, month, day){\n        return Date.parse(\n                new Date(year, month - 1, day)\n            )\n    }\n    this.toHourMs = function (year, month, day, hour){\n        return Date.parse(\n                new Date(year, month - 1, day, hour)\n            )\n    }\n})\n\n"],"sourceRoot":"/source/"}