angular.module("ShinyaNews",["ngTouch","ngAnimate","ui.router","angular-storage","ShinyaNews.stopPropagationDirective","ShinyaNews.i18nDirective","ShinyaNews.fullscreenButtonDirective","ShinyaNews.timeMachineDirective","ShinyaNews.timeHelperServices","ShinyaNews.selectNewsItemServices","ShinyaNews.oneDayStoreServices","ShinyaNews.UIServices"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,t,s){s.otherwise(function(){var e=new Date,t=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),o=e.getHours(),i=JSON.parse(localStorage.getItem("syNewsCountry"))||"HK";return i+"/"+t+"/"+s+"/"+n+"?h="+o}),e.html5Mode(!0),t.state("country",{"abstract":!0,url:"/{country:BR|CN|DE|FR|HK|IN|JP|KR|RU|TW|US}",template:"<div ui-view></div>",controller:["$scope","$stateParams",function(e,t){e.saveCountry(t.country)}]}).state("date",{parent:"country",url:"/{year:2015}/{month:0?[1-9]|1[0-2]}/{day:0?[0-9]|[12][0-9]|3[0-1]}?h&q",templateUrl:"/public/dist/newsBox.min.html",controller:["$scope","$location","$stateParams","store","syNewsTimeHelper",function(e,t,s,n,o){var i=s.year,a=s.month,l=s.day,r=s.h;e.search.title=s.q,o.isToday(i,a,l)?(r>0&&24>=r?null:t.path("/"),e.selectNewsInfo.selectDate=o.toHourMs(i,a,l,r)):(e.selectOldNewsInfo.selectDate=o.toDayMs(i,a,l),n.set("lastOldNewsDate",e.selectOldNewsInfo.selectDate),e.isOldNews?null:e.toggleNews()),e.refreshNews()}]})}]).factory("oldNewsCache",["$cacheFactory",function(e){return e("oldNewsCache")}]).controller("rootController",["$scope","$http","$timeout","$window","$state","$stateParams","store","oldNewsCache","syNewsTimeHelper","sySelectNewsItem","syOneDayStore","syUI",function(e,t,s,n,o,i,a,l,r,c,w,u){function d(t,s,n){e.newsBox=t,e.isShow=s,e.isNewsExist=n}function g(s,n){e.isOldNews?N():h();var o,i=s.selectDate+e.selectCountry;if(n){if(1===y&&e.isHideCaretRight||-1===y&&e.isHideCaretLeft)return}else d([],!1,!0),e.isNewsDone=!1,w.get(i+"-Done")?e.isNewsDone=!0:e.isOldNews||(w.set(i+"-Done",!0),e.isNewsDone=!1);return(o=s.isAllDay?l.get(i):w.get(i))?void(n?null:d(o,!0,!0)):void t.post("/api/getSelectedDateNews",s).success(function(e,t,s,o){o.data.isAllDay?l.put(i,e.msg):w.set(i,e.msg),n||d(e.msg,!0,!0)}).error(function(e,t,s,o){n||d([],!0,!1)})}function h(){var t=e.selectNewsInfo.selectDate;e.isHideCaretLeft=t-36e5===r.getDayMs(new Date)?!0:!1,e.isHideCaretRight=t+36e5>Date.now()?!0:!1}function N(){var t=e.selectOldNewsInfo.selectDate;e.isHideCaretLeft=!1,e.isHideCaretRight=t+1728e5>Date.now()?!0:!1}a.get("oneDayNewsExpires")<Date.now()?w.removeAll():null,e.isShow=!1,e.isNewsExist=!0,e.isOldNews=!1,e.isShowTimeMachine=!1,e.toggleNews=function(){if(u.toggleBGC(),u.cardFlip(),e.isOldNews){var t=new Date(e.selectNewsInfo.selectDate||r.getHoursMs((new Date).getHours()));o.go("date",{year:t.getFullYear().toString(),month:(t.getMonth()+1).toString(),day:t.getDate().toString(),h:t.getHours().toString(),q:null})}else{var s=new Date(e.selectOldNewsInfo.selectDate||r.getDayMs(Date.now())-864e5);o.go("date",{year:s.getFullYear().toString(),month:(s.getMonth()+1).toString(),day:s.getDate().toString(),h:null,q:i.h?null:i.q})}e.isOldNews=!e.isOldNews},e.updateQueryParam=function(e){o.go("date",{q:e},{notify:!1,reload:!0})};var y=-1;e.newsBox=[],e.selectCountry=a.get("syNewsCountry")||"HK",e.selectNewsInfo={selectDate:0,selectCountry:e.selectCountry,isAllDay:!1},e.selectOldNewsInfo={selectDate:a.get("lastOldNewsDate"),selectCountry:e.selectCountry,isAllDay:!0},e.timeMachineInfo={},e.search={},e.isHideCaretLeft=!1,e.isHideCaretRight=!1,e.selectNews=function(t){if(u.toggleDirection(t),!(1===t&&e.isHideCaretRight||-1===t&&e.isHideCaretLeft)){if(e.isOldNews){var s=r.getDateObj(e.selectOldNewsInfo.selectDate+864e5*t);o.go("date",{month:s.month,day:s.day,h:null,q:null})}else o.go("date",{h:(parseInt(i.h?i.h:(new Date).getHours())+t).toString(),q:null});t===y?g({selectDate:e.isOldNews?e.selectOldNewsInfo.selectDate+1728e5*t:e.selectNewsInfo.selectDate+72e5*t,selectCountry:e.selectCountry,isAllDay:e.isOldNews?!0:!1},!0):y=t,c.reset()}},e.timeMachineSelectNews=function(t){if(e.isOldNews)u.toggleDirection(e.timeMachineInfo.M<=i.month&&e.timeMachineInfo.D<=i.day?-1:1),o.go("date",{month:e.timeMachineInfo.M,day:e.timeMachineInfo.D,h:null,q:null});else{var s=t?-1===t?1:(new Date).getHours():e.timeMachineInfo.H;u.toggleDirection(s<=i.h?-1:1),o.go("date",{h:s,q:null})}e.isShowTimeMachine=!1},e.refreshNews=function(){g(e.isOldNews?e.selectOldNewsInfo:e.selectNewsInfo)},e.$watch("search.title",function(e,t){e!==t&&o.go("date",{q:e},{notify:!1,reload:!0})}),n.addEventListener("keydown",function(t){var s=t.keyCode;37===s?e.selectNews(-1):39===s?e.selectNews(1):38===s?c.go(-1):40===s?c.go(1):null})}]);
angular.module("ShinyaNews.fullscreenButtonDirective",[]).directive("syNewsFullscreenButton",function(){return{restrict:"E",template:'\n            <svg class="fullscreen corner--bottom--left animate--faster" viewBox="0 0 156 158" xmlns="http://www.w3.org/2000/svg">\n                <path class="animate--faster" d="M46.453 115.914c7.449 9.512 6.807 23.33-1.927 32.1-9.426 9.466-24.709 9.466-34.136 0-9.426-9.466-9.426-24.813 0-34.279 8.967-9.004 23.233-9.443 32.717-1.317l68.339-68.625c-8.751-9.508-8.528-24.344.669-33.58 9.426-9.466 24.709-9.466 34.136 0 9.426 9.466 9.426 24.813 0 34.279-8.497 8.532-21.752 9.374-31.188 2.524l-68.611 68.898z" stroke="#CECECF" stroke-width="5" fill="#CECECF"/>\n            </svg>\n        ',link:function(e,n,t){n.bind("click",function(e){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():null:document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null})}}});
angular.module("ShinyaNews.i18nDirective",[]).directive("syNewsI18n",function(){return{restrict:"E",replace:!0,template:'\n            <div class="corner--top--left animate--faster">\n                <div ng-repeat="country in countryList" class="toolBar__button--country animate--faster" ng-class="country" ng-click="changeCountry(country)">\n                    {{country}}\n                </div>\n            </div>\n        ',controller:["$scope","$timeout","$state","$stateParams","store","sySelectNewsItem",function(t,n,e,r,o,c){function s(){for(var n=0;n<i.length;n++){{var e=t.countryList;e.length-1}e[0]!==i[n]?e.push(i[n]):null,t.countryList=e}}function u(e){var r=t.countryList,o=(r.length-1,r.indexOf(e));r.splice(o,1),r.unshift(e),t.countryList=r,n(function(){e===r[0]&&(t.countryList=[e])})}var i=["HK","CN","JP","TW","US","BR","IN","KR","RU","DE","FR"];t.countryList=[t.selectCountry],t.changeCountry=function(n){{var r=t.countryList.length;i.indexOf(n)}n===t.countryList[0]?i.length===r?u(n):s():e.go("date",{country:n})},t.saveCountry=function(n){o.set("syNewsCountry",n),t.selectCountry=n,t.selectNewsInfo.selectCountry=n,t.selectOldNewsInfo.selectCountry=n,u(n),c.reset()}}]}});
angular.module("ShinyaNews.stopPropagationDirective",[]).directive("syNewsStopPropagation",function(){return{restrict:"A",link:function(t,i,n){i.bind("click",function(t){t.stopPropagation()}),i.bind("touchstart",function(t){t.stopPropagation()})}}});
angular.module("ShinyaNews.timeMachineDirective",[]).directive("syNewsTimeMachine",function(){return{restrict:"E",template:'\n            <div>\n                <div ng-if="isShowTimeMachine" ng-click="toggleTimeMachine()" class="timeMachine animate--faster">\n                    <div class="vertically_center">\n                        <div class="timeMachine__inner">\n                            <form novalidate ng-submit="timeMachineSelectNews()" name="form" sy-news-stop-propagation>\n                                <div ng-if="!isOldNews">\n                                    <input type="number" placeholder="H" ng-model="timeMachineInfo.H" class="animate--faster" min="1" max="24" required>:\n                                    <input type="number" placeholder="00" disabled>\n                                </div>\n                                <div ng-if="isOldNews">\n                                    <input type="number" placeholder="15" disabled>-\n                                    <input type="number" placeholder="M" ng-model="timeMachineInfo.M" class="animate--faster" min="1" max="12" required>-\n                                    <input type="number" placeholder="D" ng-model="timeMachineInfo.D" class="animate--faster" min="1" max="31" required>\n                                </div>\n                            </form>\n                            <div sy-news-stop-propagation>\n                                <svg ng-click="timeMachineSelectNews(-1)" class="timeMachine__button timeMachine__button--fillTRI float--left" viewBox="0 0 208 208" xmlns="http://www.w3.org/2000/svg">\n                                    <g fill="#FFF" stroke="#000" stroke-width="7">\n                                        <circle cx="104" cy="104" r="100"/>\n                                        <g stroke-linecap="round" stroke-linejoin="round">\n                                            <path d="M97.489 59l-44.489 44.567 44.489 44.567"/>\n                                            <path class="animate--faster" d="M135 149v-89.135l-49.723 44.567 49.723 44.567z"/>\n                                        </g>\n                                    </g>\n                                </svg>\n                                <svg ng-click="timeMachineSelectNews()" class="timeMachine__button timeMachine__button--fillBG" ng-class="{\'timeMachine__button--invalid\': form.$invalid}" viewBox="0 0 208 208" xmlns="http://www.w3.org/2000/svg" >\n                                    <g class="animate--faster" fill="#FFF" stroke="#000" stroke-width="7">\n                                        <circle stroke="#000" cx="104" cy="104" r="100"/>\n                                        <g class="animate--faster" stroke="#000" stroke-linecap="round">\n                                            <path d="M82 146l70.711-70.711"/>\n                                            <path d="M82 146l-25.456-25.456"/>\n                                        </g>\n                                    </g>\n                                </svg>\n                                <svg ng-click="toggleTimeMachine()" class="timeMachine__button timeMachine__button--fillBG" viewBox="0 0 208 208" xmlns="http://www.w3.org/2000/svg">\n                                    <g class="animate--faster" fill="#FFF" stroke="#000" stroke-width="7">\n                                        <circle storke="#000" cx="104" cy="104" r="100"/>\n                                        <g class="animate--faster" stroke="#000" stroke-linecap="round">\n                                            <path d="M76.427 132.987l56.56-56.56"/>\n                                            <path d="M132.284 132.284l-56.569-56.569"/>\n                                        </g>\n                                    </g>\n                                </svg>\n                                <svg ng-click="timeMachineSelectNews(1)" class="timeMachine__button timeMachine__button--fillTRI float--right" viewBox="0 0 208 208" xmlns="http://www.w3.org/2000/svg">\n                                    <g fill="#FFF" stroke="#000" stroke-width="7">\n                                        <circle cx="104" cy="104" r="100"/>\n                                        <g stroke-linecap="round" stroke-linejoin="round">\n                                            <path d="M111.511 59l44.489 44.567-44.489 44.567"/>\n                                            <path class="animate--faster" d="M74 149v-89.135l49.723 44.567-49.723 44.567z"/>\n                                        </g>\n                                    </g>\n                                </svg>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <svg ng-click="toggleTimeMachine()" class="toolBar__button--timeMachine animate--faster" viewBox="0 0 214 214" xmlns="http://www.w3.org/2000/svg">\n                    <g transform="translate(7 7)" fill="none">\n                        <circle class="animate--faster" stroke="#CECECF" stroke-width="7" cx="100" cy="100" r="100"/>\n                        <g class="animate--faster" transform="translate(26 25)" fill="#CECECF">\n                            <circle cx="74.5" cy="75.5" r="18.5"/>\n                            <circle cx="130.5" cy="75.5" r="18.5"/>\n                            <circle cx="18.5" cy="75.5" r="18.5"/>\n                            <circle cx="74.5" cy="19.5" r="18.5"/>\n                            <circle cx="74.5" cy="131.5" r="18.5"/>\n                        </g>\n                    </g>\n                </svg>\n            </div>\n        ',controller:["$scope",function(e){e.toggleTimeMachine=function(){e.timeMachineInfo={H:new Date(e.selectNewsInfo.selectDate).getHours(),M:new Date(e.selectOldNewsInfo.selectDate).getMonth()+1,D:new Date(e.selectOldNewsInfo.selectDate).getDate()},e.isShowTimeMachine=!e.isShowTimeMachine}}]}});
angular.module("ShinyaNews.UIServices",[]).service("syUI",["$timeout",function(e){this.cardFlip=function(){var n=angular.element(document.getElementById("view-newsBox"));n.addClass("cardFlip"),e(function(){n.removeClass("cardFlip")},777)},this.toggleBGC=function(){angular.element(document.documentElement).toggleClass("oldNews")},this.toggleDirection=function(e){var n=angular.element(document.getElementById("view-newsBox"));1===e?n.removeClass("rtl"):n.addClass("rtl")}}]);
angular.module("ShinyaNews.oneDayStoreServices",[]).service("syOneDayStore",["$window","store","syNewsTimeHelper",function(e,t,o){var n=t.getNamespacedStore("one-day-news","-");this.get=function(e){return n.get(e)},this.set=function(e,s){n.set(e,s);var a=Date.now()+864e5;t.set("oneDayNewsExpires",o.getDayMs(a))},this.removeAll=function(){for(var o=e.localStorage,n=localStorage.length,s=/^one-day-news-/,a=0,r=0;n>r;r++)s.test(o.key(a))?t.remove(o.key(a)):a++}}]);
angular.module("ShinyaNews.selectNewsItemServices",[]).service("sySelectNewsItem",function(){this.id=-1,this.go=function(i){var s=document.getElementsByClassName("newsBox__news__item__title"),t=s.length;-1===i&&this.id>0&&this.id<t?(this.id--,s[this.id].focus()):1===i&&this.id>=-1&&this.id<t-1&&(this.id++,s[this.id].focus())},this.reset=function(){this.id=-1}});
angular.module("ShinyaNews.timeHelperServices",[]).service("syNewsTimeHelper",function(){this.getHoursMs=function(e){var t=new Date;return Date.parse(new Date(t.getFullYear(),t.getMonth(),t.getDate(),e))},this.getDayMs=function(e){var e=new Date(e);return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate()))},this.getDateObj=function(e){var t=new Date(e);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()}},this.isToday=function(e,t,a){var n=new Date,r=n.getFullYear(),s=n.getMonth()+1,u=n.getDate();return e==r&&t==s&&a==u},this.toDayMs=function(e,t,a){return Date.parse(new Date(e,t-1,a))},this.toHourMs=function(e,t,a,n){return Date.parse(new Date(e,t-1,a,n))}});
//# sourceMappingURL=sy-news.min.js.map