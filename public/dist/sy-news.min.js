angular.module("ShinyaNews",["ngTouch","ngAnimate","angular-storage","ShinyaNews.stopPropagationDirective","ShinyaNews.i18nDirective","ShinyaNews.timeHelperServices"]).factory("oneDayStore",["store",function(e){return e.getNamespacedStore("one-day-news","-")}]).controller("rootController",["$scope","$http","$timeout","$window","store","oneDayStore","syNewsTimeHelper",function(e,t,s,n,o,i,l){function a(n){e.isOldNews?w():c();var o,l=n.selectDate+e.selectCountry;return e.newsBox=[],e.isShow=!1,e.isNewsExist=!0,(o=n.isAllDay?N[l]:i.get(l))?(e.newsBox=o,e.isShow=!0,void(e.isNewsExist=!0)):void t.post("/api/getSelectedDateNews",n).success(function(t,n,o,i){i.data.isAllDay?N[l]=t.msg:r(l,t.msg),s(function(){e.newsBox=t.msg,e.isShow=!0,e.isNewsExist=!0},717)}).error(function(t,n,o,i){s(function(){e.newsBox=[],e.isShow=!0,e.isNewsExist=!1},717)})}function c(){var t=e.selectNewsInfo.selectDate;e.isHideCaretLeft=t-36e5===l.getDayMs(new Date)?!0:!1,e.isHideCaretRight=t+36e5>Date.now()?!0:!1}function w(){var t=e.selectOldNewsInfo.selectDate;e.isHideCaretLeft=!1,e.isHideCaretRight=t+1728e5>Date.now()?!0:!1}function r(e,t){i.set(e,t);var s=Date.now()+864e5;o.set("oneDayNewsExpires",l.getDayMs(s))}function f(){for(var e=n.localStorage,t=localStorage.length,s=/^one-day-news-/,i=0,l=0;t>l;l++)s.test(e.key(i))?o.remove(e.key(i)):i++}e.isShow=!1,e.isNewsExist=!0,e.isOldNews=!1,e.isShowTimeMachine=!1,e.toggleNews=function(){e.isOldNews=!e.isOldNews,angular.element(document.documentElement).toggleClass("oldNews"),e.refreshNews()},e.toggleTimeMachine=function(){e.timeMachineInfo={H:new Date(e.selectNewsInfo.selectDate).getHours(),M:new Date(e.selectOldNewsInfo.selectDate).getMonth()+1,D:new Date(e.selectOldNewsInfo.selectDate).getDate()},e.isShowTimeMachine=!e.isShowTimeMachine};var N={};e.newsBox=[],e.selectCountry=o.get("syNewsCountry")||"HK",e.selectNewsInfo={selectDate:l.getHoursMs((new Date).getHours()),selectCountry:e.selectCountry,isAllDay:!1},e.selectOldNewsInfo={selectDate:l.getDayMs(Date.now())-864e5,selectCountry:e.selectCountry,isAllDay:!0},e.timeMachineInfo={H:(new Date).getHours(),M:(new Date).getMonth()+1,D:(new Date).getDate()},e.isHideCaretLeft=!1,e.isHideCaretRight=!1,e.selectNews=function(t){e.isOldNews?(e.selectOldNewsInfo.selectDate+=864e5*t,a(e.selectOldNewsInfo)):(e.selectNewsInfo.selectDate+=36e5*t,a(e.selectNewsInfo))},e.timeMachineSelectNews=function(){e.isOldNews?(e.selectOldNewsInfo.selectDate=l.getDayMs(new Date(2015,e.timeMachineInfo.M-1,e.timeMachineInfo.D)),a(e.selectOldNewsInfo)):(e.selectNewsInfo.selectDate=l.getHoursMs(e.timeMachineInfo.H),a(e.selectNewsInfo)),e.isShowTimeMachine=!1},e.refreshNews=function(){a(e.isOldNews?e.selectOldNewsInfo:e.selectNewsInfo)},e.$watch("selectCountry",function(t,s){e.selectNewsInfo.selectCountry=t,e.selectOldNewsInfo.selectCountry=t,e.refreshNews()}),c(),a(e.selectNewsInfo),o.get("oneDayNewsExpires")<Date.now()?f():null}]);
angular.module("ShinyaNews.i18nDirective",[]).directive("syNewsI18n",function(){return{restrict:"E",replace:!0,template:'<div class="corner--top--left animate--faster"><div ng-repeat="country in countryList" class="toolBar__button--country animate--faster" ng-class="country" ng-click="changeLanguage(country)">{{country}}</div></div>',controller:["$scope","$timeout","store",function(t,n,e){function r(){for(var n=0;n<i.length;n++){{var e=t.countryList;e.length-1}e[0]!==i[n]?e.push(i[n]):null,t.countryList=e}}function c(e){var r=t.countryList,c=(r.length-1,r.indexOf(e));r.splice(c,1),r.unshift(e),t.countryList=r,n(function(){e===r[0]&&(t.countryList=[e])})}var i=["HK","CN","JP","TW","US","BR","IN","KR","RU","DE","FR"];t.countryList=[t.selectCountry],t.changeLanguage=function(n){{var o=t.countryList.length;i.indexOf(n)}n===t.countryList[0]?i.length===o?c(n):r():(e.set("syNewsCountry",n),t.selectCountry=n,c(n))}}]}});
angular.module("ShinyaNews.stopPropagationDirective",[]).directive("syNewsStopPropagation",function(){return{restrict:"A",link:function(t,i,n){i.bind("click",function(t){t.stopPropagation()}),i.bind("touchstart",function(t){t.stopPropagation()})}}});
angular.module("ShinyaNews.timeHelperServices",[]).service("syNewsTimeHelper",function(){this.getHoursMs=function(e){var t=new Date,a=t.getTimezoneOffset()/60;return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),e+a)},this.getDayMs=function(e){var e=new Date(e);return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate()))}});
//# sourceMappingURL=sy-news.min.js.map