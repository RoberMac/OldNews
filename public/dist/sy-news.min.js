angular.module("ShinyaNews",["ngTouch","ngAnimate","ui.router","angular-storage","ShinyaNews.stopPropagationDirective","ShinyaNews.i18nDirective","ShinyaNews.timeHelperServices"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,t,s){s.otherwise(function(){var e=new Date,t=e.getFullYear(),s=e.getMonth()+1,a=e.getDate(),n=e.getHours(),o=localStorage.getItem("syNewsCountry")||'"HK"';return JSON.parse(o)+"/"+t+"/"+s+"/"+a+"?h="+n}),e.html5Mode(!0),t.state("country",{"abstract":!0,url:"/{country:BR|CN|DE|FR|HK|IN|JP|KR|RU|TW|US}",template:"<div ui-view></div>",controller:["$scope","$stateParams",function(e,t){e.saveCountry(t.country)}]}).state("date",{parent:"country",url:"/{year:2015}/{month:0?[1-9]|1[0-2]}/{day:0?[0-9]|[12][0-9]|3[0-1]}?h&q",templateUrl:"/public/dist/newsBox.min.html",controller:["$scope","$location","$stateParams","store","syNewsTimeHelper",function(e,t,s,a,n){var o=s.year,l=s.month,r=s.day,i=s.h;e.search.title=s.q,n.isToday(o,l,r)?(i>0&&24>=i?null:t.path("/"),e.selectNewsInfo.selectDate=n.toHourMs(o,l,r,i)):(e.selectOldNewsInfo.selectDate=n.toDayMs(o,l,r),a.set("lastOldNewsDate",e.selectOldNewsInfo.selectDate),e.isOldNews?null:e.toggleNews()),e.refreshNews()}]})}]).factory("oneDayStore",["store",function(e){return e.getNamespacedStore("one-day-news","-")}]).controller("rootController",["$scope","$http","$timeout","$window","$state","$stateParams","store","oneDayStore","syNewsTimeHelper",function(e,t,s,a,n,o,l,r,i){function c(t,s,a){e.newsBox=t,e.isShow=s,e.isNewsExist=a}function d(s,a){e.isOldNews?w():u();var n,o=s.selectDate+e.selectCountry;if(a){if(1===m&&e.isHideCaretRight||-1===m&&e.isHideCaretLeft)return}else c([],!1,!0);return(n=s.isAllDay?h[o]:r.get(o))?void(a?null:c(n,!0,!0)):void t.post("/api/getSelectedDateNews",s).success(function(e,t,s,n){n.data.isAllDay?h[o]=e.msg:y(o,e.msg),a||c(e.msg,!0,!0)}).error(function(e,t,s,n){a||c([],!0,!1)})}function u(){var t=e.selectNewsInfo.selectDate;e.isHideCaretLeft=t-36e5===i.getDayMs(new Date)?!0:!1,e.isHideCaretRight=t+36e5>Date.now()?!0:!1}function w(){var t=e.selectOldNewsInfo.selectDate;e.isHideCaretLeft=!1,e.isHideCaretRight=t+1728e5>Date.now()?!0:!1}function y(e,t){r.set(e,t);var s=Date.now()+864e5;l.set("oneDayNewsExpires",i.getDayMs(s))}function g(){for(var e=a.localStorage,t=localStorage.length,s=/^one-day-news-/,n=0,o=0;t>o;o++)s.test(e.key(n))?l.remove(e.key(n)):n++}l.get("oneDayNewsExpires")<Date.now()?g():null,e.isShow=!1,e.isNewsExist=!0,e.isOldNews=!1,e.isShowTimeMachine=!1,e.toggleNews=function(){var t=angular.element(document.getElementById("view-newsBox"));if(t.addClass("cardFlip"),s(function(){t.removeClass("cardFlip")},777),e.isOldNews){var a=new Date(e.selectNewsInfo.selectDate||i.getHoursMs((new Date).getHours()));n.go("date",{year:a.getFullYear().toString(),month:(a.getMonth()+1).toString(),day:a.getDate().toString(),h:a.getHours().toString(),q:null})}else{var l=new Date(e.selectOldNewsInfo.selectDate||i.getDayMs(Date.now())-864e5);n.go("date",{year:l.getFullYear().toString(),month:(l.getMonth()+1).toString(),day:l.getDate().toString(),h:null,q:o.h?null:o.q})}e.isOldNews=!e.isOldNews,angular.element(document.documentElement).toggleClass("oldNews")},e.toggleTimeMachine=function(){e.timeMachineInfo={H:new Date(e.selectNewsInfo.selectDate).getHours(),M:new Date(e.selectOldNewsInfo.selectDate).getMonth()+1,D:new Date(e.selectOldNewsInfo.selectDate).getDate()},e.isShowTimeMachine=!e.isShowTimeMachine},e.updateQueryParam=function(e){n.go("date",{year:o.year,month:o.month,day:o.day,h:o.h,q:e},{notify:!1,reload:!1})};var h={},m=-1;e.newsBox=[],e.selectCountry=l.get("syNewsCountry")||"HK",e.selectNewsInfo={selectDate:0,selectCountry:e.selectCountry,isAllDay:!1},e.selectOldNewsInfo={selectDate:l.get("lastOldNewsDate"),selectCountry:e.selectCountry,isAllDay:!0},e.timeMachineInfo={},e.search={},e.isHideCaretLeft=!1,e.isHideCaretRight=!1,e.selectNews=function(t){var s=angular.element(document.getElementById("view-newsBox"));1===t?s.removeClass("rtl"):s.addClass("rtl"),1===t&&e.isHideCaretRight||-1===t&&e.isHideCaretLeft||(e.isOldNews?n.go("date",{year:o.year,month:o.month,day:(parseInt(o.day)+t).toString(),h:null,q:null}):n.go("date",{year:o.year,month:o.month,day:o.day,h:(parseInt(o.h?o.h:(new Date).getHours())+t).toString(),q:null}),t===m?d({selectDate:e.isOldNews?e.selectOldNewsInfo.selectDate+1728e5*t:e.selectNewsInfo.selectDate+72e5*t,selectCountry:e.selectCountry,isAllDay:e.isOldNews?!0:!1},!0):m=t)},e.timeMachineSelectNews=function(){e.isOldNews?n.go("date",{year:o.year,month:e.timeMachineInfo.M,day:e.timeMachineInfo.D,h:null,q:null}):n.go("date",{year:o.year,month:o.month,day:o.day,h:e.timeMachineInfo.H,q:null}),e.isShowTimeMachine=!1},e.refreshNews=function(){d(e.isOldNews?e.selectOldNewsInfo:e.selectNewsInfo)},e.$watch("search.title",function(e,t){e!==t&&n.go("date",{year:o.year,month:o.month,day:o.day,h:o.h,q:e},{notify:!1,reload:!1})})}]);
angular.module("ShinyaNews.i18nDirective",[]).directive("syNewsI18n",function(){return{restrict:"E",replace:!0,template:'<div class="corner--top--left animate--faster"><div ng-repeat="country in countryList" class="toolBar__button--country animate--faster" ng-class="country" ng-click="changeCountry(country)">{{country}}</div></div>',controller:["$scope","$timeout","$state","$stateParams","store",function(t,n,e,r,o){function c(){for(var n=0;n<u.length;n++){{var e=t.countryList;e.length-1}e[0]!==u[n]?e.push(u[n]):null,t.countryList=e}}function s(e){var r=t.countryList,o=(r.length-1,r.indexOf(e));r.splice(o,1),r.unshift(e),t.countryList=r,n(function(){e===r[0]&&(t.countryList=[e])})}var u=["HK","CN","JP","TW","US","BR","IN","KR","RU","DE","FR"];t.countryList=[t.selectCountry],t.changeCountry=function(n){{var o=t.countryList.length;u.indexOf(n)}n===t.countryList[0]?u.length===o?s(n):c():e.go("date",{country:n,year:r.year,month:r.month,day:r.day,h:r.h})},t.saveCountry=function(n){o.set("syNewsCountry",n),t.selectCountry=n,t.selectNewsInfo.selectCountry=n,t.selectOldNewsInfo.selectCountry=n,s(n)}}]}});
angular.module("ShinyaNews.stopPropagationDirective",[]).directive("syNewsStopPropagation",function(){return{restrict:"A",link:function(t,i,n){i.bind("click",function(t){t.stopPropagation()}),i.bind("touchstart",function(t){t.stopPropagation()})}}});
angular.module("ShinyaNews.timeHelperServices",[]).service("syNewsTimeHelper",function(){this.getHoursMs=function(e){var t=new Date;return Date.parse(new Date(t.getFullYear(),t.getMonth(),t.getDate(),e))},this.getDayMs=function(e){var e=new Date(e);return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate()))},this.isToday=function(e,t,a){var n=new Date,r=n.getFullYear(),s=n.getMonth()+1,u=n.getDate();return e==r&&t==s&&a==u},this.toDayMs=function(e,t,a){return Date.parse(new Date(e,t-1,a))},this.toHourMs=function(e,t,a,n){return Date.parse(new Date(e,t-1,a,n))}});
//# sourceMappingURL=sy-news.min.js.map