angular.module("ShinyaNews",["ngTouch","ngAnimate","ui.router","angular-storage","ShinyaNews.stopPropagationDirective","ShinyaNews.i18nDirective","ShinyaNews.timeHelperServices"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,t,s){s.otherwise(function(){var e=new Date,t=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),o=e.getHours(),l=localStorage.getItem("syNewsCountry").split('"')[1]||"HK";return l+"/"+t+"/"+s+"/"+n+"?h="+o}),e.html5Mode(!0),t.state("country",{"abstract":!0,url:"/{country:BR|CN|DE|FR|HK|IN|JP|KR|RU|TW|US}",template:"<ui-view/>",onEnter:function(){console.log("...")}}).state("date",{parent:"country",url:"/2015/{month:0?[1-9]|1[0-2]}/{day:0?[0-9]|[12][0-9]|3[0-1]}?h",templateUrl:"/public/dist/newsBox.min.html",controller:["$stateParams",function(e){var t=e.country,s=e.month,n=e.day,o=e.h;console.log(t,s,n,o)}]})}]).factory("oneDayStore",["store",function(e){return e.getNamespacedStore("one-day-news","-")}]).controller("rootController",["$scope","$http","$timeout","$window","store","oneDayStore","syNewsTimeHelper",function(e,t,s,n,o,l,a){function i(t,s,n){e.newsBox=t,e.isShow=s,e.isNewsExist=n}function c(s,n){e.isOldNews?w():r();var o,a=s.selectDate+e.selectCountry;if(n){if(1===N&&e.isHideCaretRight||-1===N&&e.isHideCaretLeft)return}else i([],!1,!0);return(o=s.isAllDay?D[a]:l.get(a))?void(n?null:i(o,!0,!0)):void t.post("/api/getSelectedDateNews",s).success(function(e,t,s,o){o.data.isAllDay?D[a]=e.msg:u(a,e.msg),n||i(e.msg,!0,!0)}).error(function(e,t,s,o){n||i([],!0,!1)})}function r(){var t=e.selectNewsInfo.selectDate;e.isHideCaretLeft=t-36e5===a.getDayMs(new Date)?!0:!1,e.isHideCaretRight=t+36e5>Date.now()?!0:!1}function w(){var t=e.selectOldNewsInfo.selectDate;e.isHideCaretLeft=!1,e.isHideCaretRight=t+1728e5>Date.now()?!0:!1}function u(e,t){l.set(e,t);var s=Date.now()+864e5;o.set("oneDayNewsExpires",a.getDayMs(s))}function f(){for(var e=n.localStorage,t=localStorage.length,s=/^one-day-news-/,l=0,a=0;t>a;a++)s.test(e.key(l))?o.remove(e.key(l)):l++}o.get("oneDayNewsExpires")<Date.now()?f():null,e.isShow=!1,e.isNewsExist=!0,e.isOldNews=!1,e.isShowTimeMachine=!1,e.toggleNews=function(){e.isOldNews=!e.isOldNews,angular.element(document.documentElement).toggleClass("oldNews"),e.refreshNews()},e.toggleTimeMachine=function(){e.timeMachineInfo={H:new Date(e.selectNewsInfo.selectDate).getHours(),M:new Date(e.selectOldNewsInfo.selectDate).getMonth()+1,D:new Date(e.selectOldNewsInfo.selectDate).getDate()},e.isShowTimeMachine=!e.isShowTimeMachine};var D={},N=-1;e.newsBox=[],e.selectCountry=o.get("syNewsCountry")||"HK",e.selectNewsInfo={selectDate:l.get("lastNewsDate")||a.getHoursMs((new Date).getHours()),selectCountry:e.selectCountry,isAllDay:!1},e.selectOldNewsInfo={selectDate:o.get("lastOldNewsDate")||a.getDayMs(Date.now())-864e5,selectCountry:e.selectCountry,isAllDay:!0},e.timeMachineInfo={H:(new Date).getHours(),M:(new Date).getMonth()+1,D:(new Date).getDate()},e.isHideCaretLeft=!1,e.isHideCaretRight=!1,e.selectNews=function(t){1===t&&e.isHideCaretRight||-1===t&&e.isHideCaretLeft||(e.isOldNews?e.selectOldNewsInfo.selectDate+=864e5*t:e.selectNewsInfo.selectDate+=36e5*t,t===N?c({selectDate:e.isOldNews?e.selectOldNewsInfo.selectDate+864e5*t:e.selectNewsInfo.selectDate+36e5*t,selectCountry:e.selectCountry,isAllDay:e.isOldNews?!0:!1},!0):N=t)},e.timeMachineSelectNews=function(){e.isOldNews?e.selectOldNewsInfo.selectDate=a.getDayMs(new Date(2015,e.timeMachineInfo.M-1,e.timeMachineInfo.D)):e.selectNewsInfo.selectDate=a.getHoursMs(e.timeMachineInfo.H),e.isShowTimeMachine=!1},e.refreshNews=function(){c(e.isOldNews?e.selectOldNewsInfo:e.selectNewsInfo)},e.$watch("selectCountry",function(t,s){t!==s&&(e.selectNewsInfo.selectCountry=t,e.selectOldNewsInfo.selectCountry=t,e.refreshNews())}),e.$watch("selectNewsInfo.selectDate",function(t,s){t!==s&&(l.set("lastNewsDate",e.selectNewsInfo.selectDate),c(e.selectNewsInfo))}),e.$watch("selectOldNewsInfo.selectDate",function(t,s){t!==s&&(o.set("lastOldNewsDate",e.selectOldNewsInfo.selectDate),c(e.selectOldNewsInfo))}),e.$watch("newsBox",function(e,t){e!==t&&(document.getElementsByClassName("newsBox__news")[0].scrollTop=0)}),r(),c(e.selectNewsInfo)}]);
angular.module("ShinyaNews.i18nDirective",[]).directive("syNewsI18n",function(){return{restrict:"E",replace:!0,template:'<div class="corner--top--left animate--faster"><div ng-repeat="country in countryList" class="toolBar__button--country animate--faster" ng-class="country" ng-click="changeLanguage(country)">{{country}}</div></div>',controller:["$scope","$timeout","store",function(t,n,e){function r(){for(var n=0;n<i.length;n++){{var e=t.countryList;e.length-1}e[0]!==i[n]?e.push(i[n]):null,t.countryList=e}}function c(e){var r=t.countryList,c=(r.length-1,r.indexOf(e));r.splice(c,1),r.unshift(e),t.countryList=r,n(function(){e===r[0]&&(t.countryList=[e])})}var i=["HK","CN","JP","TW","US","BR","IN","KR","RU","DE","FR"];t.countryList=[t.selectCountry],t.changeLanguage=function(n){{var o=t.countryList.length;i.indexOf(n)}n===t.countryList[0]?i.length===o?c(n):r():(e.set("syNewsCountry",n),t.selectCountry=n,c(n))}}]}});
angular.module("ShinyaNews.stopPropagationDirective",[]).directive("syNewsStopPropagation",function(){return{restrict:"A",link:function(t,i,n){i.bind("click",function(t){t.stopPropagation()}),i.bind("touchstart",function(t){t.stopPropagation()})}}});
angular.module("ShinyaNews.timeHelperServices",[]).service("syNewsTimeHelper",function(){this.getHoursMs=function(e){var t=new Date;return Date.parse(new Date(t.getFullYear(),t.getMonth(),t.getDate(),e))},this.getDayMs=function(e){var e=new Date(e);return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate()))}});
//# sourceMappingURL=sy-news.min.js.map