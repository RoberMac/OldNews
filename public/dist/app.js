function config(e,n,o){o.otherwise(function(){var e=new Date,n=e.getFullYear(),o=e.getMonth()+1,t=e.getDate(),r=e.getHours(),s=JSON.parse(window.localStorage.getItem("sy-country"))||"HK";return s+"/"+n+"/"+o+"/"+t+"?h="+r}),e.html5Mode(!0),n.state("news",{url:["/{country:BR|CN|DE|FR|HK|IN|JP|KR|RU|TW|US}","/{year:201[5-6]}","/{month:0?[1-9]|1[0-2]}","/{day:0?[0-9]|[12][0-9]|3[0-1]}","?h","&q"].join(""),templateUrl:"components/NewsBox/NewsBox.html",controller:"NewsBoxCtrl",controllerAs:"newsVM"})}config.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"],angular.module("ShinyaNews",["ngTouch","ngAnimate","ui.router","ShinyaNews.utils.controllers","ShinyaNews.utils.services","ShinyaNews.utils.directives","ShinyaNews.components.NewsBox","ShinyaNews.components.TimeMachine","ShinyaNews.components.Nav","ShinyaNews.templates"]).config(config);
angular.module("ShinyaNews.templates",[]).run(["$templateCache",function(n){n.put("components/Nav/Caret.html",'<div>\n\n    <button\n        ng-if="navVM.state.isShowCaretLeft"\n        ng-click="navVM.selectNews(-1)"\n        class="btn--caret btn--caret--left tips--deep animate--faster"\n    >\n        <sy-icon name="caret-left"></sy-icon>\n    </button>\n\n    <button\n        ng-if="navVM.state.isShowCaretRight"\n        ng-click="navVM.selectNews(1)"\n        class="btn--caret btn--caret--right tips--deep animate--faster"\n    >\n        <sy-icon name="caret-right"></sy-icon>\n    </button>\n\n</div>'),n.put("components/Nav/ChooseCountry.html",'<div class="btn--t--l animate--faster">\n    <ul>\n        <li ng-repeat="country in navVM.state.countryList" class="animate--faster">\n            <button\n                class="btn--country shadow animate--faster {{ \'btn--country--\' + country }}"\n                ng-click="navVM.handleCountryClick(country)"\n            >\n                {{::country}}\n            </button>\n        </li>\n    </ul>\n</div>'),n.put("components/Nav/ClickableLogo.html",'<button class="btn--t--r" ng-click="navVM.togglehNewsType()">\n    <span class="btn--logo animate--general" alt="logo"></span>\n</button>'),n.put("components/Nav/Nav.html","<div>\n\n    <div ng-include=\"'components/Nav/Caret.html'\"></div>\n    <div ng-include=\"'components/Nav/ClickableLogo.html'\"></div>\n    <div ng-include=\"'components/Nav/ChooseCountry.html'\"></div>\n\n<div>"),n.put("components/NewsBox/FetchState.html",'<!-- Not Found -->\n<div ng-if="newsVM.state.isFetchFail" class="newsState--fetchFail animate--general">\n    <sy-icon name="NotFound" viewbox="0 0 474 584"></sy-icon>\n</div>\n\n<!-- Spin -->\n<div ng-if="newsVM.state.isFetching" class="newsState--fetching animate--general"></div>\n'),n.put("components/NewsBox/Heading.html",'<h3>\n    <span ng-click="newsVM.handleHeadingClick()" class="cursor--pointer" role="button">\n        <span ng-if="!rootVM.state.isOldNews">{{newsVM.state.newsDate | date:\'HH:00\'}}</span>\n        <span ng-if="rootVM.state.isOldNews">{{newsVM.state.newsDate | date:\'yyyy-MM-dd\'}}</span>\n    </span>\n</h3>'),n.put("components/NewsBox/NewsBox.html",'<div\n    class="newsBox animate--general shadow"\n    ng-swipe-left="newsVM.handleSwipe(1)"\n    ng-swipe-right="newsVM.handleSwipe(-1)"\n    ng-swipe-disable-mouse\n>\n\n    <!-- Heading -->\n    <div ng-include="\'components/NewsBox/Heading.html\'"></div>\n\n    <!-- Content -->\n    <div class="newsBox__content overflow--y">\n\n        <div ng-if="newsVM.state.newsData.length > 0">\n            <div ng-include="\'components/NewsBox/SearchBar.html\'"></div>\n        </div>\n\n        <div ng-if="newsVM.state.newsData.length > 0" ng-include="\'components/NewsBox/NewsItem.html\'"></div>\n\n        <div ng-include="\'components/NewsBox/FetchState.html\'"></div>\n\n    </div>\n</div>'),n.put("components/NewsBox/NewsItem.html",'<ul ng-repeat="sourceItem in newsVM.state.newsData | filter: newsVM.state.searchText">\n    <!-- Source: Provider -->\n    <h4>{{::sourceItem.source_name}}</h4>\n    <!-- Source: News -->\n    <li\n        ng-repeat="newsItem in sourceItem.news | orderBy: \'date\' | filter: newsVM.state.searchText"\n        class="newsItem"\n    >\n\n        <!-- News: Created At -->\n        <span class="newsItem__createdAt">{{::newsItem.date | date: \'HH:mm\'}}</span>\n        <!-- News: Title -->\n        <a class="newsItem__title" ng-href="{{::newsItem.url}}" target="_blank">{{::newsItem.title}}</a>\n        <!-- News: Source Link -->\n        <button ng-click="newsVM.updateQueryParam(newsItem.title)" class="newsItem__link">\n            <sy-icon name="link"></sy-icon>\n        </button>\n\n    </li>\n</ul>'),n.put("components/NewsBox/SearchBar.html",'<form class="searchBar" novalidate name="searchForm">\n\n    <input\n        class="searchBar__input cursor--pointer animate--faster"\n        ng-class="{\'searchBar__input--valid\': searchForm.$valid}"\n        ng-model="newsVM.state.searchText"\n        ng-model-options="{ debounce: 300 }"\n        type="text"\n        required\n    >\n\n</form>'),n.put("components/TimeMachine/Form.html",'<form\n    sy-stop-propagation\n    ng-submit="tmVM.handleSubmit()"\n    class="timeMachine__form shadow animate--faster"\n    name="tmVM.form"\n    novalidate\n>\n    <div ng-if="!rootVM.state.isOldNews">\n        <input\n            sy-auto-focus="700"\n            type="number"\n            placeholder="H"\n            ng-model="tmVM.state.timeMachine.H"\n            ng-model-options="{ debounce: 300 }"\n            class="timeMachine__input shadow--onFocus animate--faster"\n            min="1"\n            max="24"\n            required\n        >\n        <span>:</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            type="number"\n            placeholder="00"\n            disabled\n        >\n    </div>\n    <div ng-if="rootVM.state.isOldNews">\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.Y"\n            ng-model-options="{ debounce: 300 }"\n            type="number"\n            placeholder="Y"\n            min="15"\n            max="16"\n            required\n        >\n        <span>-</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.M"\n            ng-model-options="{ debounce: 300 }"\n            type="number"\n            placeholder="M"\n            min="1"\n            max="12"\n            required\n        >\n        <span>-</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.D"\n            ng-model-options="{ debounce: 300 }"\n            sy-auto-focus="700"\n            type="number"\n            placeholder="D"\n            min="1"\n            max="31"\n            required\n        >\n    </div>\n</form>'),n.put("components/TimeMachine/TimeMachine.html",'<div>\n    <!-- Time Machine: Start Button -->\n    <button ng-click="tmVM.toggleTimeMachine()" class="btn--timeMachine tips--deep animate--faster">\n        <sy-icon name="time_machine"></sy-icon>\n    </button>\n\n    <!-- Time Machine: Content -->\n    <div\n        ng-if="tmVM.state.isShowTimeMachine"\n        ng-click="tmVM.toggleTimeMachine()"\n        class="timeMachine vertically_center animate--faster"\n    >\n            <div class="timeMachine__content animate--general">\n                <div ng-include="\'components/TimeMachine/Form.html\'"></div>\n                <div ng-include="\'components/TimeMachine/ToolBar.html\'"></div>\n            </div>\n    </div>\n</div>'),n.put("components/TimeMachine/ToolBar.html",'<div sy-stop-propagation>\n    <button\n        ng-if="!tmVM.form.$invalid"\n        ng-click="tmVM.handleSubmit()"\n        class="timeMachine__btn tips"\n    >\n        <sy-icon name="ok"></sy-icon>\n    </button>\n    <button\n        ng-click="tmVM.toggleTimeMachine()"\n        class="timeMachine__btn tips"\n    >\n        <sy-icon name="cancel"></sy-icon>\n    </button>\n</div>')}]);
function syNav(){return{restrict:"E",replace:!0,controller:NavCtrl,controllerAs:"navVM",templateUrl:"components/Nav/Nav.html"}}function NavCtrl(t,e,s,a,n,o,r,i,c){function u(e){var s=t.rootVM.state.isOldNews,o=c.newsDateMs(s);if((1!==e||v.state.isShowCaretRight)&&(-1!==e||v.state.isShowCaretLeft))switch(s){case!0:var r=c.dateFormatter(o+i.ONE_DAY*e);a.go("news",{year:r.year,month:r.month,day:r.day,h:null,q:null});break;case!1:var u=parseInt(n.h||(new Date).getHours())+e;a.go("news",{h:u,q:null})}}function h(){v.state.countryList=f()}function l(t,e){v.selectNews(e.step)}function w(){var e=t.rootVM.state.isOldNews,s=c.newsDateMs(e);switch(e){case!0:v.state.isShowCaretLeft=!0,v.state.isShowCaretRight=s+i.TWO_DAYS<=Date.now();break;case!1:v.state.isShowCaretLeft=s-i.ONE_HOUR!==c.todayMs(),v.state.isShowCaretRight=s+i.ONE_HOUR<=Date.now()}}function y(){var e,s=t.rootVM.state.isOldNews;switch(s){case!0:e=c.nowHourMs(),s=!1;break;case!1:e=c.todayMs()-i.ONE_DAY,s=!0}e=c.dateFormatter(e),a.go("news",{year:e.year,month:e.month,day:e.day,h:s?null:e.hour,q:null})}function N(t){function e(t){var e=v.state.countryList[0],s=[e];switch(1===v.state.countryList.length){case!0:r.forEach(function(t){e!==t&&s.push(t)}),v.state.countryList=s;break;case!1:n(t)}}function n(t){var e=angular.copy(v.state.countryList),a=e.indexOf(t);e.splice(a,1),e.unshift(t),v.state.countryList=e,s(function(){t===e[0]&&(v.state.countryList=[t])})}switch(t===v.state.countryList[0]){case!0:e(t);break;case!1:a.go("news",{country:t}),n(t)}}function f(){return[o.get("sy-country")||"HK"]}var v=this;this.state={isShowCaretLeft:!0,isShowCaretRight:!0,countryList:f()},v.selectNews=u,v.togglehNewsType=y,v.handleCountryClick=N,t.$on("keyDown:esc",h),t.$on("keyDown:leftOrRightArrow",l),t.$on("fetchNews:start",w)}NavCtrl.$inject=["$scope","$window","$timeout","$state","$stateParams","store","COUNTRIES","TIME","TimeHelper"],angular.module("ShinyaNews.components.Nav",[]).constant("COUNTRIES",["HK","CN","JP","TW","US","BR","IN","KR","RU","DE","FR"]).directive("syNav",syNav);
function NewsBoxCtrl(e,t,a,n,s,o,c,r){function i(e){angular.merge(f.state,e)}function u(e){f.updateState({searchText:e}),n.go("news",{q:e},{notify:!1,reload:!0})}function l(t){e.$broadcast("selectNews",{step:t})}function d(){e.$broadcast("toggleTimeMachine")}function w(){f.updateQueryParam(""),document.querySelector(".searchBar__input").blur()}function h(e,t){var a=document.querySelectorAll(".newsItem__title"),n=a.length;if(!(0>=n)){var s=t.step,o=f.state.selectedNewsIndex;-1===s&&o>0&&n>o?o--:1===s&&o>=-1&&n-1>o&&o++,a[o].focus(),f.updateState({selectedNewsIndex:o})}}function p(){var a=s.country,n=!c.isToday(),i=c.newsDateMs(n);o.set("sy-country",a),f.updateState({newsDate:i}),e.$broadcast("fetchNews:start"),r(i,a,n).then(function(e){f.updateState({isFetching:!1,isFetchFail:!1,newsData:e})})["catch"](function(){f.updateState({isFetching:!1,isFetchFail:!0})})["finally"](function(){t.rootVM.updateState({isOldNews:n})})}var f=this;f.state={isFetching:!0,isFetchFail:!1,newsData:[],newsDate:0,selectedNewsIndex:-1,searchText:s.q},f.updateState=i,f.updateQueryParam=u,f.handleSwipe=l,f.handleHeadingClick=d,t.$on("keyDown:esc",w),t.$on("keyDown:upOrDownArrow",h),t.$watch("newsVM.state.searchText",function(e,t){e!==t&&f.updateQueryParam(e)}),p()}NewsBoxCtrl.$inject=["$rootScope","$scope","$location","$state","$stateParams","store","TimeHelper","FetchNews"],angular.module("ShinyaNews.components.NewsBox",[]).controller("NewsBoxCtrl",NewsBoxCtrl);
function syTimeMachine(){return{restrict:"E",replace:!0,controller:TimeMachineCtrl,controllerAs:"tmVM",templateUrl:"components/TimeMachine/TimeMachine.html"}}function TimeMachineCtrl(e,t,a,i){function n(){var t=i.newsDateMs(e.rootVM.state.isOldNews),a=i.dateFormatter(t);o.state.timeMachine={Y:a.year%2e3,M:a.month,D:a.day,H:a.hour},o.state.isShowTimeMachine=!o.state.isShowTimeMachine}function s(){o.state.isShowTimeMachine&&o.toggleTimeMachine()}function c(){switch(e.rootVM.state.isOldNews){case!0:t.go("news",{year:"20"+o.state.timeMachine.Y,month:o.state.timeMachine.M,day:o.state.timeMachine.D,h:null,q:null});break;case!1:var a=o.state.timeMachine.H;t.go("news",{h:a,q:null})}o.state.isShowTimeMachine=!1}function h(t,a){var i,n=Date.now();switch(e.rootVM.state.isOldNews){case!0:i=Date.parse(new Date("20"+o.state.timeMachine.Y,o.state.timeMachine.M-1,o.state.timeMachine.D));break;case!1:i=Date.parse(new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),o.state.timeMachine.H))}o.form&&o.form.$setValidity("maxDate",n>=i)}var o=this;o.state={isShowTimeMachine:!1,timeMachine:{Y:0,M:0,D:0,H:0}},o.toggleTimeMachine=n,o.handleSubmit=c,e.$on("keyDown:esc",s),e.$on("toggleTimeMachine",n),e.$watchCollection("tmVM.state.timeMachine",h)}TimeMachineCtrl.$inject=["$scope","$state","$stateParams","TimeHelper"],angular.module("ShinyaNews.components.TimeMachine",[]).directive("syTimeMachine",syTimeMachine);
angular.module("ShinyaNews.utils.controllers",[]),angular.module("ShinyaNews.utils.services",[]),angular.module("ShinyaNews.utils.directives",[]);
function rootCtrl(t,e){function r(t){angular.merge(a.state,t)}function o(e){var r=e.keyCode,o=e.target.tagName.toLowerCase();switch(r){case 27:t.$broadcast("keyDown:esc");break;case 37:case 39:if("input"===o)return;t.$broadcast("keyDown:leftOrRightArrow",{step:37===r?-1:1});break;case 38:case 40:if("input"===o)return;t.$broadcast("keyDown:upOrDownArrow",{step:38===r?-1:1})}}var a=this;a.state={isOldNews:!1},a.updateState=r,angular.element(e).on("keydown",o)}rootCtrl.$inject=["$rootScope","$window"],angular.module("ShinyaNews.utils.controllers").controller("rootCtrl",rootCtrl);
function autoFocus(u){return{restrict:"A",scope:{},link:function(o,t,c){var i=~~c.syAutoFocus||0;u(function(){t[0].focus()},i)}}}autoFocus.$inject=["$timeout"],angular.module("ShinyaNews.utils.directives").directive("syAutoFocus",autoFocus);
function syIcon(){return{restrict:"E",replace:!0,template:function(e,i){var n=i.viewbox||"0 0 100 100",s=i.name;return['<svg viewBox="'+n+'">','<use xlink:href="/public/img/icon-sprites.svg#'+s+'"></use>',"</svg>"].join("")}}}angular.module("ShinyaNews.utils.directives").directive("syIcon",syIcon);
function stopPropagation(){return{restrict:"A",link:function(t,o,i){function n(t){t.stopPropagation()}o.on("click",n),o.on("touchstart",n)}}}angular.module("ShinyaNews.utils.directives").directive("syStopPropagation",stopPropagation);
function NewsStore(e,t,r,o,s){function n(e){return t.get(r+e)}function c(e,n){t.set(r+e,n),t.set(r+"expiration-date",o.todayMs()+s.ONE_DAY)}function a(){for(var o=e.localStorage,s=new RegExp("^"+r),n=0,c=0,a=localStorage.length;a>n;n++)s.test(o.key(c))?t.remove(o.key(c)):c++}return{get:n,set:c,removeAll:a}}function OldNewsStore(e){return e("OldNewsStore")}function FetchNews(e,t,r,o){return function(s,n,c){var a=s+n,i=c?o.get(a):r.get(a);return e(function(e,l){return s&&n?void(i?e(i):t.post("/api/getSelectedDateNews",{selectDate:s,selectCountry:n,isAllDay:c}).success(function(t,s,n,i){switch(c){case!0:o.put(a,t.msg);break;case!1:r.set(a,t.msg)}e(t.msg)}).error(function(e,t,r,o){l()})):void l("invalid params")})}}NewsStore.$inject=["$window","store","STORE_PREFIX","TimeHelper","TIME"],OldNewsStore.$inject=["$cacheFactory"],FetchNews.$inject=["$q","$http","NewsStore","OldNewsStore"],angular.module("ShinyaNews.utils.services").constant("STORE_PREFIX","sy-news-").factory("NewsStore",NewsStore).factory("OldNewsStore",OldNewsStore).factory("FetchNews",FetchNews).run(["store","STORE_PREFIX","NewsStore",function(e,t,r){e.get(t+"expiration-date")<Date.now()&&r.removeAll()}]);
function TimeHelper(e){function t(){var e=new Date;return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()))}function a(){var e=new Date;return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate()))}function r(t){var a=e.year,r=e.month,n=e.day,o=e.h;return Date.parse(new Date(a,r-1,n,t?null:o))}function n(){var t=e.year,a=e.month,r=e.day,n=(e.h,o(Date.now()));return t==n.year&&a==n.month&&r==n.day}function o(e){var t=new Date(e);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours()}}return{nowHourMs:t,todayMs:a,newsDateMs:r,isToday:n,dateFormatter:o}}TimeHelper.$inject=["$stateParams"],angular.module("ShinyaNews.utils.services").constant("TIME",{ONE_HOUR:36e5,ONE_DAY:864e5,TWO_DAYS:1728e5}).factory("TimeHelper",TimeHelper);
function store(t){function e(e){return o(t.localStorage.getItem(e))}function r(e,r){return t.localStorage.setItem(e,JSON.stringify(r))}function n(e){t.localStorage.removeItem(e)}function o(t){try{t=JSON.parse(t)}catch(e){}finally{return t}}return{get:e,set:r,remove:n}}store.$inject=["$window"],angular.module("ShinyaNews.utils.services").factory("store",store);
//# sourceMappingURL=app.js.map
