function config(e,n,o){o.otherwise(function(){var e=new Date,n=e.getFullYear(),o=e.getMonth()+1,t=e.getDate(),r=e.getHours(),s=angular.fromJson(window.localStorage.getItem("sy-country"))||"HK";return s+"/"+n+"/"+o+"/"+t+"?h="+r}),e.html5Mode(!0),n.state("news",{url:["/{country:BR|CN|DE|FR|HK|IN|JP|KR|RU|TW|US}","/{year:201[5-6]}","/{month:0?[1-9]|1[0-2]}","/{day:0?[0-9]|[12][0-9]|3[0-1]}","?h","&q"].join(""),templateUrl:"components/NewsBox/NewsBox.html",controller:"NewsBoxCtrl",controllerAs:"newsVM"})}config.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"],angular.module("ShinyaNews",["ngTouch","ngAnimate","ui.router","ShinyaNews.utils.controllers","ShinyaNews.utils.services","ShinyaNews.utils.directives","ShinyaNews.components.NewsBox","ShinyaNews.components.TimeMachine","ShinyaNews.components.Nav","ShinyaNews.templates"]).config(config);
angular.module("ShinyaNews.templates",[]).run(["$templateCache",function(n){n.put("components/Nav/Caret.html",'<div>\n\n    <button\n        ng-if="navVM.state.isShowCaretLeft"\n        ng-click="navVM.selectNews(-1)"\n        class="btn--caret btn--caret--left tips--deep animate--faster"\n    >\n        <sy-icon name="caret-left"></sy-icon>\n    </button>\n\n    <button\n        ng-if="navVM.state.isShowCaretRight"\n        ng-click="navVM.selectNews(1)"\n        class="btn--caret btn--caret--right tips--deep animate--faster"\n    >\n        <sy-icon name="caret-right"></sy-icon>\n    </button>\n\n</div>'),n.put("components/Nav/ChooseCountry.html",'<div class="btn--t--l animate--faster">\n    <ul>\n        <li ng-repeat="country in navVM.state.countryList" class="animate--faster">\n            <button\n                class="btn--country shadow animate--faster {{ \'btn--country--\' + country }}"\n                ng-click="navVM.handleCountryClick(country)"\n            >\n                {{::country}}\n            </button>\n        </li>\n    </ul>\n</div>'),n.put("components/Nav/ClickableLogo.html",'<button class="btn--t--r" ng-click="navVM.togglehNewsType()">\n    <span class="btn--logo animate--general" alt="logo"></span>\n</button>'),n.put("components/Nav/Nav.html","<div>\n\n    <div ng-include=\"'components/Nav/Caret.html'\"></div>\n    <div ng-include=\"'components/Nav/ClickableLogo.html'\"></div>\n    <div ng-include=\"'components/Nav/ChooseCountry.html'\"></div>\n\n<div>"),n.put("components/NewsBox/FetchState.html",'<!-- Not Found -->\n<div ng-if="newsVM.state.isFetchFail" class="newsState--fetchFail animate--general">\n    <sy-icon name="NotFound" viewbox="0 0 474 584"></sy-icon>\n</div>\n\n<!-- Spin -->\n<div ng-if="newsVM.state.isFetching" class="newsState--fetching animate--general"></div>\n'),n.put("components/NewsBox/Heading.html",'<h3>\n    <span ng-click="newsVM.handleHeadingClick()" class="cursor--pointer" role="button">\n        <span ng-if="!rootVM.state.isOldNews">{{newsVM.state.newsDate | date:\'HH:00\'}}</span>\n        <span ng-if="rootVM.state.isOldNews">{{newsVM.state.newsDate | date:\'yyyy-MM-dd\'}}</span>\n    </span>\n</h3>'),n.put("components/NewsBox/NewsBox.html",'<div\n    class="newsBox animate--general shadow"\n    ng-swipe-left="newsVM.handleSwipe(1)"\n    ng-swipe-right="newsVM.handleSwipe(-1)"\n    ng-swipe-disable-mouse\n>\n\n    <!-- Heading -->\n    <div ng-include="\'components/NewsBox/Heading.html\'"></div>\n\n    <!-- Content -->\n    <div class="newsBox__content overflow--y">\n\n        <div ng-if="newsVM.state.newsData.length > 0">\n            <div ng-include="\'components/NewsBox/SearchBar.html\'"></div>\n        </div>\n\n        <div ng-if="newsVM.state.newsData.length > 0" ng-include="\'components/NewsBox/NewsItem.html\'"></div>\n\n        <div ng-include="\'components/NewsBox/FetchState.html\'"></div>\n\n    </div>\n</div>'),n.put("components/NewsBox/NewsItem.html",'<ul ng-repeat="sourceItem in newsVM.state.newsData | filter: newsVM.state.searchText">\n    <!-- Source: Provider -->\n    <h4>{{::sourceItem.source_name}}</h4>\n    <!-- Source: News -->\n    <li\n        ng-repeat="newsItem in sourceItem.news | orderBy: \'date\' | filter: newsVM.state.searchText"\n        class="newsItem"\n    >\n\n        <!-- News: Created At -->\n        <span class="newsItem__createdAt">{{::newsItem.date | date: \'HH:mm\'}}</span>\n        <!-- News: Title -->\n        <a class="newsItem__title" ng-href="{{::newsItem.url}}" target="_blank">{{::newsItem.title}}</a>\n        <!-- News: Source Link -->\n        <button ng-click="newsVM.updateQueryParam(newsItem.title)" class="newsItem__link">\n            <sy-icon name="link"></sy-icon>\n        </button>\n\n    </li>\n</ul>'),n.put("components/NewsBox/SearchBar.html",'<form class="searchBar" novalidate name="searchForm">\n\n    <input\n        class="searchBar__input cursor--pointer animate--faster"\n        ng-class="{\'searchBar__input--valid\': searchForm.$valid}"\n        ng-model="newsVM.state.searchText"\n        ng-model-options="{ debounce: 300 }"\n        ng-change="newsVM.updateQueryParam(newsVM.state.searchText)"\n        type="text"\n        required\n    >\n\n</form>'),n.put("components/TimeMachine/Form.html",'<form\n    sy-stop-propagation\n    ng-submit="tmVM.handleSubmit()"\n    class="timeMachine__form shadow animate--faster"\n    name="tmVM.form"\n    novalidate\n>\n    <div ng-if="!rootVM.state.isOldNews">\n        <input\n            sy-auto-focus="700"\n            type="number"\n            placeholder="H"\n            ng-model="tmVM.state.timeMachine.H"\n            ng-model-options="{ debounce: 300 }"\n            ng-change="tmVM.dateValidation()"\n            class="timeMachine__input shadow--onFocus animate--faster"\n            min="1"\n            max="24"\n            required\n        >\n        <span>:</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            type="number"\n            placeholder="00"\n            disabled\n        >\n    </div>\n    <div ng-if="rootVM.state.isOldNews">\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.Y"\n            ng-model-options="{ debounce: 300 }"\n            ng-change="tmVM.dateValidation()"\n            type="number"\n            placeholder="Y"\n            min="15"\n            max="16"\n            required\n        >\n        <span>-</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.M"\n            ng-model-options="{ debounce: 300 }"\n            ng-change="tmVM.dateValidation()"\n            type="number"\n            placeholder="M"\n            min="1"\n            max="12"\n            required\n        >\n        <span>-</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.D"\n            ng-model-options="{ debounce: 300 }"\n            ng-change="tmVM.dateValidation()"\n            sy-auto-focus="700"\n            type="number"\n            placeholder="D"\n            min="1"\n            max="31"\n            required\n        >\n    </div>\n</form>'),n.put("components/TimeMachine/TimeMachine.html",'<div>\n    <!-- Time Machine: Start Button -->\n    <button ng-click="tmVM.toggleTimeMachine()" class="btn--timeMachine tips--deep animate--faster">\n        <sy-icon name="time_machine"></sy-icon>\n    </button>\n\n    <!-- Time Machine: Content -->\n    <div\n        ng-if="tmVM.state.isShowTimeMachine"\n        ng-click="tmVM.toggleTimeMachine()"\n        class="timeMachine vertically_center animate--faster"\n    >\n            <div class="timeMachine__content animate--general">\n                <div ng-include="\'components/TimeMachine/Form.html\'"></div>\n                <div ng-include="\'components/TimeMachine/ToolBar.html\'"></div>\n            </div>\n    </div>\n</div>'),n.put("components/TimeMachine/ToolBar.html",'<div sy-stop-propagation>\n    <button\n        ng-if="!tmVM.form.$invalid"\n        ng-click="tmVM.handleSubmit()"\n        class="timeMachine__btn tips"\n    >\n        <sy-icon name="ok"></sy-icon>\n    </button>\n    <button\n        ng-click="tmVM.toggleTimeMachine()"\n        class="timeMachine__btn tips"\n    >\n        <sy-icon name="cancel"></sy-icon>\n    </button>\n</div>')}]);
function syNav(){return{restrict:"E",replace:!0,controller:NavCtrl,controllerAs:"navVM",templateUrl:"components/Nav/Nav.html"}}function NavCtrl(t,e,s,n,o,a,r,i,c){function u(e){var s,a,r=t.rootVM.state.isOldNews,u=c.newsDateMs(r);1===e&&!v.state.isShowCaretRight||-1===e&&!v.state.isShowCaretLeft||(r?(s=c.dateFormatter(u+i.ONE_DAY*e),n.go("news",{year:s.year,month:s.month,day:s.day,h:null,q:null})):(a=parseInt(o.h||(new Date).getHours(),10)+e,n.go("news",{h:a,q:null})))}function l(){v.state.countryList=g()}function y(t,e){v.selectNews(e.step)}function h(t,e){v.selectNews(e.step)}function w(){var e=t.rootVM.state.isOldNews,s=c.newsDateMs(e);e?(v.state.isShowCaretLeft=!0,v.state.isShowCaretRight=s+i.TWO_DAYS<=Date.now()):(v.state.isShowCaretLeft=s-i.ONE_HOUR!==c.todayMs(),v.state.isShowCaretRight=s+i.ONE_HOUR<=Date.now()),v.state.countryList[0]!==o.country&&(v.state.countryList=g())}function N(){var e,s=t.rootVM.state.isOldNews;s?(e=c.nowHourMs(),s=!1):(e=c.todayMs()-i.ONE_DAY,s=!0),e=c.dateFormatter(e),n.go("news",{year:e.year,month:e.month,day:e.day,h:s?null:e.hour,q:null})}function f(t){function e(t){var e=v.state.countryList[0],s=[e];1===v.state.countryList.length?(r.forEach(function(t){e!==t&&s.push(t)}),v.state.countryList=s):o(t)}function o(t){var e=angular.copy(v.state.countryList),n=e.indexOf(t);e.splice(n,1),e.unshift(t),v.state.countryList=e,s(function(){t===e[0]&&(v.state.countryList=[t])})}t===v.state.countryList[0]?e(t):(n.go("news",{country:t}),o(t))}function g(){return[o.country||a.get("sy-country")||"HK"]}var v=this;this.state={isShowCaretLeft:!0,isShowCaretRight:!0,countryList:g()},v.selectNews=u,v.togglehNewsType=N,v.handleCountryClick=f,t.$on("keyDown:esc",l),t.$on("keyDown:leftOrRightArrow",y),t.$on("swipe:leftOrRight",h),t.$on("fetchNews:start",w)}NavCtrl.$inject=["$scope","$window","$timeout","$state","$stateParams","store","COUNTRIES","TIME","TimeHelper"],angular.module("ShinyaNews.components.Nav",[]).constant("COUNTRIES",["BR","CN","DE","FR","HK","IN","JP","KR","RU","TW","US"]).directive("syNav",syNav);
function NewsBoxCtrl(e,t,a,n,s,o,c,i){function r(e){angular.merge(f.state,e)}function u(e){f.updateState({searchText:e}),n.go("news",{q:e},{notify:!1,reload:!0})}function l(t){e.$broadcast("swipe:leftOrRight",{step:t})}function d(){e.$broadcast("toggleTimeMachine")}function w(){f.updateQueryParam(""),document.querySelector(".searchBar__input").blur()}function h(e,t){var a,n,s=document.querySelectorAll(".newsItem__title"),o=s.length;0>=o||(a=t.step,n=f.state.selectedNewsIndex,-1===a&&n>0&&o>n?n--:1===a&&n>=-1&&o-1>n&&n++,s[n].focus(),f.updateState({selectedNewsIndex:n}))}function p(){var a=s.country,n=!c.isToday(),r=c.newsDateMs(n);o.set("sy-country",a),f.updateState({newsDate:r}),e.$broadcast("fetchNews:start"),i(r,a,n).then(function(e){f.updateState({isFetching:!1,isFetchFail:!1,newsData:e})})["catch"](function(){f.updateState({isFetching:!1,isFetchFail:!0})})["finally"](function(){t.rootVM.updateState({isOldNews:n})})}var f=this;f.state={isFetching:!0,isFetchFail:!1,newsData:[],newsDate:0,selectedNewsIndex:-1,searchText:s.q},f.updateState=r,f.updateQueryParam=u,f.handleSwipe=l,f.handleHeadingClick=d,t.$on("keyDown:esc",w),t.$on("keyDown:upOrDownArrow",h),p()}NewsBoxCtrl.$inject=["$rootScope","$scope","$location","$state","$stateParams","store","TimeHelper","FetchNews"],angular.module("ShinyaNews.components.NewsBox",[]).controller("NewsBoxCtrl",NewsBoxCtrl);
function syTimeMachine(){return{restrict:"E",replace:!0,controller:TimeMachineCtrl,controllerAs:"tmVM",templateUrl:"components/TimeMachine/TimeMachine.html"}}function TimeMachineCtrl(e,t,i,a){function n(){var t=a.newsDateMs(e.rootVM.state.isOldNews),i=a.dateFormatter(t);h.state.timeMachine={Y:i.year%2e3,M:i.month,D:i.day,H:i.hour},h.state.isShowTimeMachine=!h.state.isShowTimeMachine}function s(){h.state.isShowTimeMachine&&h.toggleTimeMachine()}function o(){e.rootVM.state.isOldNews?t.go("news",{year:"20"+h.state.timeMachine.Y,month:h.state.timeMachine.M,day:h.state.timeMachine.D,h:null,q:null}):t.go("news",{h:h.state.timeMachine.H,q:null}),h.state.isShowTimeMachine=!1}function c(){var t,i=Date.now();t=e.rootVM.state.isOldNews?+new Date("20"+h.state.timeMachine.Y,h.state.timeMachine.M-1,h.state.timeMachine.D):+new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),h.state.timeMachine.H),h.form&&h.form.$setValidity("maxDate",i>=t)}var h=this;h.state={isShowTimeMachine:!1,timeMachine:{Y:0,M:0,D:0,H:0}},h.toggleTimeMachine=n,h.handleSubmit=o,h.dateValidation=c,e.$on("keyDown:esc",s),e.$on("toggleTimeMachine",n)}TimeMachineCtrl.$inject=["$scope","$state","$stateParams","TimeHelper"],angular.module("ShinyaNews.components.TimeMachine",[]).directive("syTimeMachine",syTimeMachine);
angular.module("ShinyaNews.utils.controllers",[]),angular.module("ShinyaNews.utils.services",[]),angular.module("ShinyaNews.utils.directives",[]);
function rootCtrl(t,e){function r(t){angular.merge(a.state,t)}function o(e){var r=e.keyCode,o=e.target.tagName.toLowerCase();switch(r){case 27:t.$broadcast("keyDown:esc");break;case 37:case 39:if("input"===o)return;t.$broadcast("keyDown:leftOrRightArrow",{step:37===r?-1:1});break;case 38:case 40:if("input"===o)return;t.$broadcast("keyDown:upOrDownArrow",{step:38===r?-1:1})}}var a=this;a.state={isOldNews:!1},a.updateState=r,angular.element(e).on("keydown",o)}rootCtrl.$inject=["$rootScope","$window"],angular.module("ShinyaNews.utils.controllers").controller("rootCtrl",rootCtrl);
function autoFocus(u){return{restrict:"A",scope:{},link:function(t,o,c){var s=parseInt(c.syAutoFocus,10)||0;u(function(){o[0].focus()},s)}}}autoFocus.$inject=["$timeout"],angular.module("ShinyaNews.utils.directives").directive("syAutoFocus",autoFocus);
function syIcon(){return{restrict:"E",replace:!0,template:function(e,i){var n=i.viewbox||"0 0 100 100",s=i.name;return['<svg viewBox="'+n+'">','<use xlink:href="/public/img/icon-sprites.svg#'+s+'"></use>',"</svg>"].join("")}}}angular.module("ShinyaNews.utils.directives").directive("syIcon",syIcon);
function stopPropagation(){return{restrict:"A",link:function(t,o,i){function n(t){t.stopPropagation()}o.on("click",n),o.on("touchstart",n)}}}angular.module("ShinyaNews.utils.directives").directive("syStopPropagation",stopPropagation);
function NewsStore(e,t,r,o,n){function s(e){return t.get(r+e)}function c(e,s){t.set(r+e,s),t.set(r+"expiration-date",o.todayMs()+n.ONE_DAY)}function i(){var o,n,s,c=e.localStorage,i=new RegExp("^"+r);for(o=0,n=0,s=localStorage.length;s>o;o++)i.test(c.key(n))?t.remove(c.key(n)):n++}return{get:s,set:c,removeAll:i}}function OldNewsStore(e){return e("OldNewsStore")}function FetchNews(e,t,r,o){return function(n,s,c){var i=n+s,a=c?o.get(i):r.get(i);return e(function(e,u){return n&&s?void(a?e(a):t.get("/news/"+s+"/"+n+"/"+(c?24:1)).success(function(t){t.msg&&(c?o.put(i,t.msg):r.set(i,t.msg)),e(t.msg)}).error(function(){u()})):void u("invalid params")})}}NewsStore.$inject=["$window","store","STORE_PREFIX","TimeHelper","TIME"],OldNewsStore.$inject=["$cacheFactory"],FetchNews.$inject=["$q","$http","NewsStore","OldNewsStore"],angular.module("ShinyaNews.utils.services").constant("STORE_PREFIX","sy-news-").factory("NewsStore",NewsStore).factory("OldNewsStore",OldNewsStore).factory("FetchNews",FetchNews).run(["store","STORE_PREFIX","NewsStore",function(e,t,r){e.get(t+"expiration-date")<Date.now()&&r.removeAll()}]);
function TimeHelper(e){function t(){var e=new Date;return+new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours())}function n(){var e=new Date;return+new Date(e.getFullYear(),e.getMonth(),e.getDate())}function a(t){var n=e.year,a=e.month,r=e.day,o=e.h;return+new Date(n,a-1,r,t?null:o)}function r(){var t=parseInt(e.year,10),n=parseInt(e.month,10),a=parseInt(e.day,10),r=o(Date.now());return t===r.year&&n===r.month&&a===r.day}function o(e){var t=new Date(e);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours()}}return{nowHourMs:t,todayMs:n,newsDateMs:a,isToday:r,dateFormatter:o}}TimeHelper.$inject=["$stateParams"],angular.module("ShinyaNews.utils.services").constant("TIME",{ONE_HOUR:36e5,ONE_DAY:864e5,TWO_DAYS:1728e5}).factory("TimeHelper",TimeHelper);
function store(t){function e(e){return n(t.localStorage.getItem(e))}function o(e,o){return t.localStorage.setItem(e,angular.toJson(o))}function r(e){t.localStorage.removeItem(e)}function n(t){try{t=angular.fromJson(t)}catch(e){}finally{return t}}return{get:e,set:o,remove:r}}store.$inject=["$window"],angular.module("ShinyaNews.utils.services").factory("store",store);
//# sourceMappingURL=app.js.map
