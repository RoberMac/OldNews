function config(e,t,n){n.otherwise(function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),r=e.getHours(),s=JSON.parse(localStorage.getItem("syNewsCountry"))||"HK";return s+"/"+t+"/"+n+"/"+o+"?h="+r}),e.html5Mode(!0),t.state("news",{url:["/{country:BR|CN|DE|FR|HK|IN|JP|KR|RU|TW|US}","/{year:201[5-6]}","/{month:0?[1-9]|1[0-2]}","/{day:0?[0-9]|[12][0-9]|3[0-1]}","?h","&q"].join(""),templateUrl:"components/NewsBox/NewsBox.html",controller:"NewsBoxCtrl",controllerAs:"newsVM"})}config.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"],angular.module("ShinyaNews",["ngTouch","ngAnimate","ui.router","angular-storage","ShinyaNews.utils.controllers","ShinyaNews.utils.services","ShinyaNews.utils.directives","ShinyaNews.components.NewsBox","ShinyaNews.components.TimeMachine","ShinyaNews.components.Nav","ShinyaNews.templates"]).config(config);
angular.module("ShinyaNews.templates",[]).run(["$templateCache",function(n){n.put("components/Nav/Caret.html",'<div>\n\n    <button\n        ng-if="navVM.state.isShowCaretLeft"\n        ng-click="navVM.selectNews(-1)"\n        class="btn--caret btn--caret--left tips--deep animate--faster"\n    >\n        <sy-icon name="caret-left"></sy-icon>\n    </button>\n\n    <button\n        ng-if="navVM.state.isShowCaretRight"\n        ng-click="navVM.selectNews(1)"\n        class="btn--caret btn--caret--right tips--deep animate--faster"\n    >\n        <sy-icon name="caret-right"></sy-icon>\n    </button>\n\n</div>'),n.put("components/Nav/ChooseCountry.html",'<div class="btn--t--l animate--faster">\n    <ul>\n        <li ng-repeat="country in navVM.state.countryList" class="animate--faster">\n            <button\n                class="btn--country shadow animate--faster {{ \'btn--country--\' + country }}"\n                ng-click="navVM.handleCountryClick(country)"\n            >\n                {{::country}}\n            </button>\n        </li>\n    </ul>\n</div>'),n.put("components/Nav/ClickableLogo.html",'<button class="btn--t--r" ng-click="navVM.togglehNewsType()">\n    <span class="btn--logo animate--general" alt="logo"></span>\n</button>'),n.put("components/Nav/Nav.html","<div>\n\n    <div ng-include=\"'components/Nav/Caret.html'\"></div>\n    <div ng-include=\"'components/Nav/ClickableLogo.html'\"></div>\n    <div ng-include=\"'components/Nav/ChooseCountry.html'\"></div>\n\n<div>"),n.put("components/NewsBox/FetchState.html",'<!-- Not Found -->\n<div ng-if="newsVM.state.isFetchFail" class="newsState--fetchFail animate--general">\n    <sy-icon name="NotFound" viewbox="0 0 474 584"></sy-icon>\n</div>\n\n<!-- Spin -->\n<div ng-if="newsVM.state.isFetching" class="newsState--fetching animate--general"></div>\n'),n.put("components/NewsBox/Heading.html","<h3>\n    <span>\n        <span ng-if=\"!rootVM.state.isOldNews\">{{newsVM.state.news.date | date:'HH:00'}}</span>\n        <span ng-if=\"rootVM.state.isOldNews\">{{newsVM.state.news.date | date:'yyyy-MM-dd'}}</span>\n    </span>\n</h3>"),n.put("components/NewsBox/NewsBox.html",'<div\n    class="newsBox animate--general shadow"\n    ng-swipe-left="newsVM.handleSwipe(1)"\n    ng-swipe-right="newsVM.handleSwipe(-1)"\n    ng-swipe-disable-mouse\n>\n\n    <!-- Heading -->\n    <div ng-include="\'components/NewsBox/Heading.html\'"></div>\n\n    <!-- Content -->\n    <div class="newsBox__content overflow--y">\n\n        <div ng-if="newsVM.state.news.data.length > 0">\n            <div ng-include="\'components/NewsBox/SearchBar.html\'"></div>\n        </div>\n\n        <div ng-if="newsVM.state.news.data.length > 0" ng-include="\'components/NewsBox/NewsItem.html\'"></div>\n\n        <div ng-include="\'components/NewsBox/FetchState.html\'"></div>\n\n    </div>\n</div>'),n.put("components/NewsBox/NewsItem.html",'<ul ng-repeat="sourceItem in newsVM.state.news.data | filter: newsVM.state.searchText">\n    <!-- Source: Provider -->\n    <h4>{{::sourceItem.source_name}}</h4>\n    <!-- Source: News -->\n    <li\n        ng-repeat="newsItem in sourceItem.news | orderBy: \'date\' | filter: newsVM.state.searchText"\n        class="newsItem"\n    >\n\n        <!-- News: Created At -->\n        <span class="newsItem__createdAt">{{::newsItem.date | date: \'HH:mm\'}}</span>\n        <!-- News: Title -->\n        <a class="newsItem__title" ng-href="{{::newsItem.url}}" target="_blank">{{::newsItem.title}}</a>\n        <!-- News: Source Link -->\n        <button ng-click="newsVM.updateQueryParam(newsItem.title)" class="newsItem__link">\n            <sy-icon name="link"></sy-icon>\n        </button>\n\n    </li>\n</ul>'),n.put("components/NewsBox/SearchBar.html",'<form class="searchBar" novalidate name="searchForm">\n\n    <input\n        class="searchBar__input animate--faster"\n        ng-class="{\'searchBar__input--valid\': searchForm.$valid}"\n        ng-model="newsVM.state.searchText"\n        ng-model-options="{ debounce: 300 }"\n        type="text"\n        required\n    >\n\n</form>'),n.put("components/TimeMachine/Form.html",'<form\n    sy-stop-propagation\n    ng-submit="tmVM.handleSubmit()"\n    class="timeMachine__form shadow animate--faster"\n    name="tmVM.form"\n    novalidate\n>\n    <div ng-if="!rootVM.state.isOldNews">\n        <input\n            sy-auto-focus\n            type="number"\n            placeholder="H"\n            ng-model="tmVM.state.timeMachine.H"\n            ng-model-options="{ debounce: 300 }"\n            class="timeMachine__input shadow--onFocus animate--faster"\n            min="1"\n            max="24"\n            required\n        >\n        <span>:</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            type="number"\n            placeholder="00"\n            disabled\n        >\n    </div>\n    <div ng-if="rootVM.state.isOldNews">\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.Y"\n            ng-model-options="{ debounce: 300 }"\n            type="number"\n            placeholder="Y"\n            min="15"\n            max="16"\n            required\n        >\n        <span>-</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.M"\n            ng-model-options="{ debounce: 300 }"\n            type="number"\n            placeholder="M"\n            min="1"\n            max="12"\n            required\n        >\n        <span>-</span>\n        <input\n            class="timeMachine__input shadow--onFocus animate--faster"\n            ng-model="tmVM.state.timeMachine.D"\n            ng-model-options="{ debounce: 300 }"\n            sy-auto-focus\n            type="number"\n            placeholder="D"\n            min="1"\n            max="31"\n            required\n        >\n    </div>\n</form>'),n.put("components/TimeMachine/TimeMachine.html",'<div>\n    <!-- Time Machine: Start Button -->\n    <button ng-click="tmVM.toggleTimeMachine()" class="btn--timeMachine tips--deep animate--faster">\n        <sy-icon name="time_machine"></sy-icon>\n    </button>\n\n    <!-- Time Machine: Content -->\n    <div\n        ng-if="tmVM.state.isShowTimeMachine"\n        ng-click="tmVM.toggleTimeMachine()"\n        class="timeMachine vertically_center animate--faster"\n    >\n            <div class="timeMachine__content animate--general">\n                <div ng-include="\'components/TimeMachine/Form.html\'"></div>\n                <div ng-include="\'components/TimeMachine/ToolBar.html\'"></div>\n            </div>\n    </div>\n</div>'),n.put("components/TimeMachine/ToolBar.html",'<div sy-stop-propagation>\n    <button\n        ng-if="!tmVM.form.$invalid"\n        ng-click="tmVM.handleSubmit()"\n        class="timeMachine__btn tips animate--faster"\n    >\n        <sy-icon name="ok"></sy-icon>\n    </button>\n    <button\n        ng-click="tmVM.toggleTimeMachine()"\n        class="timeMachine__btn tips animate--faster"\n    >\n        <sy-icon name="cancel"></sy-icon>\n    </button>\n</div>')}]);
function syNav(){return{restrict:"E",replace:!0,controller:NavCtrl,controllerAs:"navVM",templateUrl:"components/Nav/Nav.html"}}function NavCtrl(t,e,a,s,n,o,r,c,i,l){function u(e){var a=t.rootVM.state.isOldNews,o=i.newsDateMs(a);if((1!==e||N.state.isShowCaretRight)&&(-1!==e||N.state.isShowCaretLeft))switch(l.toggleDirection(e),a){case!0:var r=i.dateFormatter(o+c.ONE_DAY*e);s.go("news",{year:r.year,month:r.month,day:r.day,h:null,q:null});break;case!1:var u=parseInt(n.h||(new Date).getHours())+e;s.go("news",{h:u,q:null})}}function w(){var e=t.rootVM.state.isOldNews,a=i.newsDateMs(e);switch(e){case!0:N.state.isShowCaretLeft=!0,N.state.isShowCaretRight=a+c.TWO_DAYS<=Date.now();break;case!1:N.state.isShowCaretLeft=a-c.ONE_HOUR!==i.todayMs(),N.state.isShowCaretRight=a+c.ONE_HOUR<=Date.now()}}function h(){l.cardFlip();var e,a=t.rootVM.state.isOldNews;switch(a){case!0:e=i.nowHourMs(),a=!1;break;case!1:e=i.todayMs()-c.ONE_DAY,a=!0}e=i.dateFormatter(e),s.go("news",{year:e.year,month:e.month,day:e.day,h:a?null:e.hour,q:null})}function y(t){function e(t){var e=N.state.countryList[0],a=[e];switch(1===N.state.countryList.length){case!0:r.forEach(function(t){e!==t&&a.push(t)}),N.state.countryList=a;break;case!1:n(t)}}function n(t){var e=angular.copy(N.state.countryList),s=e.indexOf(t);e.splice(s,1),e.unshift(t),N.state.countryList=e,a(function(){t===e[0]&&(N.state.countryList=[t])})}switch(t===N.state.countryList[0]){case!0:e(t);break;case!1:s.go("news",{country:t}),n(t)}}var N=this;this.state={isShowCaretLeft:!0,isShowCaretRight:!0,countryList:[o.get("syNewsCountry")||"HK"]},N.selectNews=u,N.togglehNewsType=h,N.handleCountryClick=y,angular.element(e).on("keydown",function(t){if("input"!==t.target.tagName.toLowerCase())switch(t.keyCode){case 37:N.selectNews(-1);break;case 39:N.selectNews(1)}}),t.$on("selectNews",function(t,e){N.selectNews(e.step)}),t.$on("checkCaret",function(t,e){w()})}NavCtrl.$inject=["$scope","$window","$timeout","$state","$stateParams","store","COUNTRIES","TIME","TimeHelper","Animate"],angular.module("ShinyaNews.components.Nav",[]).constant("COUNTRIES",["HK","CN","JP","TW","US","BR","IN","KR","RU","DE","FR"]).directive("syNav",syNav);
function NewsBoxCtrl(e,t,a,n,s,o,c,i,r){function u(e){angular.merge(h.state,e)}function d(e){h.updateState({searchText:e}),s.go("news",{q:e},{notify:!1,reload:!0})}function w(t){e.$broadcast("selectNews",{step:t})}function l(){var a=o.country,n=!i.isToday(),s=i.newsDateMs(n);c.set("syNewsCountry",a),h.updateState({isFetching:!0,isFetchFail:!1,news:{data:[],country:a,date:s}}),t.rootVM.updateState({isOldNews:n}),r(s,a,n).then(function(e){h.updateState({isFetching:!1,isFetchFail:!1,news:{data:e}})})["catch"](function(){h.updateState({isFetching:!1,isFetchFail:!0})}),e.$broadcast("checkCaret")}var h=this;h.state={isFetching:!0,isFetchFail:!1,news:{data:[],country:"",date:0},searchText:o.q},h.updateState=u,h.updateQueryParam=d,h.handleSwipe=w,l(),angular.element(a).on("keydown",function(e){switch(e.keyCode){case 27:h.updateQueryParam("")}}),t.$watch("newsVM.state.searchText",function(e,t){e!==t&&h.updateQueryParam(e)})}NewsBoxCtrl.$inject=["$rootScope","$scope","$window","$location","$state","$stateParams","store","TimeHelper","FetchNews"],angular.module("ShinyaNews.components.NewsBox",[]).controller("NewsBoxCtrl",NewsBoxCtrl);
function syTimeMachine(){return{restrict:"E",replace:!0,controller:TimeMachineCtrl,controllerAs:"tmVM",templateUrl:"components/TimeMachine/TimeMachine.html"}}function TimeMachineCtrl(e,t,a,i,n){function s(){var t=i.newsDateMs(e.rootVM.state.isOldNews),a=i.dateFormatter(t);h.state.timeMachine={Y:a.year%2e3,M:a.month,D:a.day,H:a.hour},h.state.isShowTimeMachine=!h.state.isShowTimeMachine}function c(){switch(e.rootVM.state.isOldNews){case!0:h.state.timeMachine.M<=a.month&&h.state.timeMachine.D<=a.day?n.toggleDirection(-1):n.toggleDirection(1),t.go("news",{year:"20"+h.state.timeMachine.Y,month:h.state.timeMachine.M,day:h.state.timeMachine.D,h:null,q:null});break;case!1:var i=h.state.timeMachine.H;i<=a.h?n.toggleDirection(-1):n.toggleDirection(1),t.go("news",{h:i,q:null})}h.state.isShowTimeMachine=!1}function o(t,a){var i;switch(e.rootVM.state.isOldNews){case!0:i=Date.parse(new Date("20"+h.state.timeMachine.Y,h.state.timeMachine.M-1,h.state.timeMachine.D));break;case!1:i=Date.parse(new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),h.state.timeMachine.H))}h.form&&h.form.$setValidity("maxDate",i<=Date.now())}var h=this;h.state={isShowTimeMachine:!1,timeMachine:{Y:0,M:0,D:0,H:0}},h.toggleTimeMachine=s,h.handleSubmit=c,e.$watchCollection("tmVM.state.timeMachine",o)}TimeMachineCtrl.$inject=["$scope","$state","$stateParams","TimeHelper","Animate"],angular.module("ShinyaNews.components.TimeMachine",[]).directive("syTimeMachine",syTimeMachine);
angular.module("ShinyaNews.utils.controllers",[]),angular.module("ShinyaNews.utils.services",[]),angular.module("ShinyaNews.utils.directives",[]);
function rootCtrl(){function t(t){angular.merge(r.state,t)}var r=this;r.state={isOldNews:!1},r.updateState=t}angular.module("ShinyaNews.utils.controllers").controller("rootCtrl",rootCtrl);
function autoFocus(){return{restrict:"A",link:function(u,t,i){t[0].focus()}}}angular.module("ShinyaNews.utils.directives").directive("syAutoFocus",autoFocus);
function syIcon(){return{restrict:"E",replace:!0,template:function(e,i){var n=i.viewbox||"0 0 100 100",s=i.name;return['<svg viewBox="'+n+'">','<use xlink:href="/public/img/icon-sprites.svg#'+s+'"></use>',"</svg>"].join("")}}}angular.module("ShinyaNews.utils.directives").directive("syIcon",syIcon);
function stopPropagation(){return{restrict:"A",link:function(t,o,i){function n(t){t.stopPropagation()}o.on("click",n),o.on("touchstart",n)}}}angular.module("ShinyaNews.utils.directives").directive("syStopPropagation",stopPropagation);
function Animate(e){function n(){var n=angular.element(document.querySelector(".ui-view-newsBox"));n.addClass("cardFlip"),e(function(){n.removeClass("cardFlip")},777)}function t(e){var n=angular.element(document.querySelector(".ui-view-newsBox"));1===e?n.removeClass("rtl"):n.addClass("rtl")}return{cardFlip:n,toggleDirection:t}}Animate.$inject=["$timeout"],angular.module("ShinyaNews.utils.services").factory("Animate",Animate);
function NewsStore(e,t,r,o){function s(e){return a.get(e)}function n(e,s){a.set(e,s),t.set("oneDayNewsExpires",r.todayMs()+o.ONE_DAY)}function c(){for(var r=e.localStorage,o=localStorage.length,s=/^one-day-news-/,n=0,c=0;o>c;c++)s.test(r.key(n))?t.remove(r.key(n)):n++}var a=t.getNamespacedStore("one-day-news","-");return{get:s,set:n,removeAll:c}}function OldNewsStore(e){return e("OldNewsStore")}function FetchNews(e,t,r,o){return function(s,n,c){var a=s+n,i=c?o.get(a):r.get(a);return e(function(e,w){return s&&n?void(i?e(i):t.post("/api/getSelectedDateNews",{selectDate:s,selectCountry:n,isAllDay:c}).success(function(t,s,n,i){switch(c){case!0:o.put(a,t.msg);break;case!1:r.set(a,t.msg)}e(t.msg)}).error(function(e,t,r,o){w()})):void w("invalid params")})}}NewsStore.$inject=["$window","store","TimeHelper","TIME"],OldNewsStore.$inject=["$cacheFactory"],FetchNews.$inject=["$q","$http","NewsStore","OldNewsStore"],angular.module("ShinyaNews.utils.services").factory("NewsStore",NewsStore).factory("OldNewsStore",OldNewsStore).factory("FetchNews",FetchNews).run(["store","NewsStore",function(e,t){e.get("oneDayNewsExpires")<Date.now()&&t.removeAll()}]);
function TimeHelper(e){function t(){var e=new Date;return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()))}function a(){var e=new Date;return Date.parse(new Date(e.getFullYear(),e.getMonth(),e.getDate()))}function r(t){var a=e.year,r=e.month,n=e.day,o=e.h;return Date.parse(new Date(a,r-1,n,t?null:o))}function n(){var t=e.year,a=e.month,r=e.day,n=(e.h,o(Date.now()));return t==n.year&&a==n.month&&r==n.day}function o(e){var t=new Date(e);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours()}}return{nowHourMs:t,todayMs:a,newsDateMs:r,isToday:n,dateFormatter:o}}TimeHelper.$inject=["$stateParams"],angular.module("ShinyaNews.utils.services").constant("TIME",{ONE_HOUR:36e5,ONE_DAY:864e5,TWO_DAYS:1728e5}).factory("TimeHelper",TimeHelper);
//# sourceMappingURL=app.js.map
